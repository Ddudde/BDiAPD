Создание БД:

CREATE DATABASE department;

\c department;

1:

CREATE TABLE WORKING_DAY (
	ID BIGINT PRIMARY KEY,
	EMPLOYEE_ID BIGINT,
	TIME_OF_TRANSFER TIMESTAMP,
	VALUE BIGINT
);

CREATE OR REPLACE FUNCTION getDopTime7_1(ID BIGINT, day interval = interval '1 days')
RETURNS interval AS $$
DECLARE
	hr interval := interval '1 hours';
	other interval := interval '1 minutes' * rand(0, 59) + interval '1 seconds' * rand(0, 59);
BEGIN
	hr := (SELECT CASE
		WHEN MOD(ID, 4) = 0 THEN hr * rand(6, 10)
		WHEN MOD(ID, 4) = 1 THEN hr * rand(11, 13)
		WHEN MOD(ID, 4) = 2 THEN hr * rand(13, 15)
		WHEN MOD(ID, 4) = 3 THEN hr * rand(16, 20)
	END);
	RETURN day + hr + other;
END $$ language plpgsql;

INSERT INTO WORKING_DAY VALUES (
				404, 66, '2023-11-22 08:13:31', 1),
				(405, 66, '2023-11-22 13:10:31', 2),
				(406, 66, '2023-11-22 13:25:31', 1),
				(407, 66, '2023-11-22 17:13:31', 2);

CREATE OR REPLACE FUNCTION getTable7_1(countEmp INTEGER, countTransfer BIGINT)
RETURNS TABLE(ID BIGINT, EMPLOYEE_ID BIGINT, TIME_OF_TRANSFER TIMESTAMP, VALUE BIGINT) AS $$
DECLARE
	startData TIMESTAMP;
	maxId BIGINT;
	id BIGINT := 0;
	day interval;
	empId BIGINT;
BEGIN
	delete FROM WORKING_DAY WHERE TRUE;
	startData := (select date_trunc('week', now()) - interval '7 days' * rand(1,30));
	for i in 0..countTransfer loop
		day := interval '1 days' * rand(0,6);
		empId := rand(50, 50 + countEmp);
		for i1 in 0..3 loop
			INSERT INTO WORKING_DAY SELECT
				id, empId, startData + getDopTime7_1(i1, day), CASE WHEN MOD(id, 2) = 0 THEN 1 ELSE 2 END;
			id := id + 1;
		end loop;
	end loop;
	RETURN query(SELECT * FROM WORKING_DAY);
END $$ language plpgsql;

SELECT * FROM getTable7_1(15, 100) limit 15;

SELECT * FROM getDopTime7_1();

DROP FUNCTION getTable7_1(countEmp BIGINT, countTransfer BIGINT);

DROP FUNCTION getDopTime7_1(ID BIGINT, day interval);

 id  | employee_id |  time_of_transfer   | value
-----+-------------+---------------------+-------
   0 |          56 | 2023-11-22 08:13:31 |     1
   1 |          56 | 2023-11-22 13:37:33 |     2
   2 |          56 | 2023-11-22 14:52:03 |     1
   3 |          56 | 2023-11-22 18:22:27 |     2
   4 |          65 | 2023-11-23 07:56:51 |     1
   5 |          65 | 2023-11-23 12:22:47 |     2
   6 |          65 | 2023-11-23 14:05:23 |     1
   7 |          65 | 2023-11-23 20:29:06 |     2
   8 |          62 | 2023-11-23 07:40:47 |     1
   9 |          62 | 2023-11-23 11:11:57 |     2
  10 |          62 | 2023-11-23 15:29:45 |     1
  11 |          62 | 2023-11-23 20:03:38 |     2
  12 |          56 | 2023-11-20 10:22:56 |     1
  13 |          56 | 2023-11-20 12:28:16 |     2
  14 |          56 | 2023-11-20 15:00:59 |     1
  15 |          56 | 2023-11-20 17:04:57 |     2
  16 |          54 | 2023-11-21 07:19:08 |     1
  17 |          54 | 2023-11-21 12:03:06 |     2
  18 |          54 | 2023-11-21 14:51:07 |     1
  19 |          54 | 2023-11-21 18:53:51 |     2
  20 |          53 | 2023-11-24 10:11:56 |     1
  21 |          53 | 2023-11-24 12:13:59 |     2
  22 |          53 | 2023-11-24 14:48:39 |     1
  23 |          53 | 2023-11-24 19:19:52 |     2
  24 |          64 | 2023-11-25 07:50:32 |     1
  25 |          64 | 2023-11-25 11:04:10 |     2
  26 |          64 | 2023-11-25 14:00:08 |     1
  27 |          64 | 2023-11-25 19:06:31 |     2
  28 |          63 | 2023-11-25 07:02:21 |     1
  29 |          63 | 2023-11-25 11:58:23 |     2
  30 |          63 | 2023-11-25 15:03:59 |     1
  31 |          63 | 2023-11-25 17:11:23 |     2
  32 |          64 | 2023-11-21 07:47:45 |     1
  33 |          64 | 2023-11-21 13:53:16 |     2
  34 |          64 | 2023-11-21 15:22:53 |     1
  35 |          64 | 2023-11-21 17:15:48 |     2
  36 |          61 | 2023-11-25 09:37:20 |     1
  37 |          61 | 2023-11-25 11:46:47 |     2
  38 |          61 | 2023-11-25 13:20:12 |     1
  39 |          61 | 2023-11-25 16:30:45 |     2
  40 |          64 | 2023-11-23 09:52:12 |     1
  41 |          64 | 2023-11-23 11:27:46 |     2
  42 |          64 | 2023-11-23 13:26:06 |     1
  43 |          64 | 2023-11-23 16:50:18 |     2
  44 |          58 | 2023-11-21 08:05:43 |     1
  45 |          58 | 2023-11-21 13:31:53 |     2
  46 |          58 | 2023-11-21 14:29:35 |     1
  47 |          58 | 2023-11-21 18:09:36 |     2
  48 |          50 | 2023-11-23 10:12:24 |     1
  49 |          50 | 2023-11-23 12:12:21 |     2
  50 |          50 | 2023-11-23 13:07:36 |     1
  51 |          50 | 2023-11-23 18:34:31 |     2
  52 |          56 | 2023-11-24 06:22:46 |     1
  53 |          56 | 2023-11-24 12:45:26 |     2
  54 |          56 | 2023-11-24 14:39:53 |     1
  55 |          56 | 2023-11-24 18:59:27 |     2
  56 |          57 | 2023-11-22 08:58:46 |     1
  57 |          57 | 2023-11-22 11:05:37 |     2
  58 |          57 | 2023-11-22 14:19:34 |     1
  59 |          57 | 2023-11-22 19:29:56 |     2
  60 |          63 | 2023-11-20 06:49:27 |     1
  61 |          63 | 2023-11-20 11:03:47 |     2
  62 |          63 | 2023-11-20 14:25:01 |     1
  63 |          63 | 2023-11-20 17:58:47 |     2
  64 |          53 | 2023-11-22 10:49:51 |     1
  65 |          53 | 2023-11-22 11:08:35 |     2
  66 |          53 | 2023-11-22 14:20:33 |     1
  67 |          53 | 2023-11-22 16:11:54 |     2
  68 |          58 | 2023-11-21 09:31:17 |     1
  69 |          58 | 2023-11-21 12:14:36 |     2
  70 |          58 | 2023-11-21 13:55:22 |     1
  71 |          58 | 2023-11-21 19:51:25 |     2
  72 |          57 | 2023-11-21 09:03:33 |     1
  73 |          57 | 2023-11-21 11:23:23 |     2
  74 |          57 | 2023-11-21 13:51:38 |     1
  75 |          57 | 2023-11-21 16:34:19 |     2
  76 |          52 | 2023-11-21 09:33:33 |     1
  77 |          52 | 2023-11-21 12:42:02 |     2
  78 |          52 | 2023-11-21 13:10:07 |     1
  79 |          52 | 2023-11-21 18:37:33 |     2
  80 |          54 | 2023-11-23 09:55:34 |     1
  81 |          54 | 2023-11-23 12:48:47 |     2
  82 |          54 | 2023-11-23 13:05:47 |     1
  83 |          54 | 2023-11-23 20:57:09 |     2
  84 |          58 | 2023-11-20 10:31:46 |     1
  85 |          58 | 2023-11-20 11:52:16 |     2
  86 |          58 | 2023-11-20 15:19:30 |     1
  87 |          58 | 2023-11-20 17:36:46 |     2
  88 |          55 | 2023-11-25 10:55:35 |     1
  89 |          55 | 2023-11-25 13:45:14 |     2
  90 |          55 | 2023-11-25 14:36:59 |     1
  91 |          55 | 2023-11-25 17:20:19 |     2
  92 |          64 | 2023-11-21 07:16:18 |     1
  93 |          64 | 2023-11-21 12:01:06 |     2
  94 |          64 | 2023-11-21 14:06:37 |     1
  95 |          64 | 2023-11-21 18:57:11 |     2
  96 |          55 | 2023-11-21 06:35:45 |     1
  97 |          55 | 2023-11-21 13:40:43 |     2
  98 |          55 | 2023-11-21 13:31:22 |     1
  99 |          55 | 2023-11-21 17:30:41 |     2
 100 |          51 | 2023-11-25 08:53:09 |     1
 101 |          51 | 2023-11-25 11:30:59 |     2
 102 |          51 | 2023-11-25 14:39:53 |     1
 103 |          51 | 2023-11-25 20:40:05 |     2
 104 |          62 | 2023-11-21 08:49:41 |     1
 105 |          62 | 2023-11-21 12:01:29 |     2
 106 |          62 | 2023-11-21 15:42:54 |     1
 107 |          62 | 2023-11-21 17:21:28 |     2
 108 |          54 | 2023-11-24 10:19:05 |     1
 109 |          54 | 2023-11-24 12:54:37 |     2
 110 |          54 | 2023-11-24 14:56:20 |     1
 111 |          54 | 2023-11-24 18:42:55 |     2
 112 |          60 | 2023-11-24 08:26:54 |     1
 113 |          60 | 2023-11-24 12:11:28 |     2
 114 |          60 | 2023-11-24 13:07:47 |     1
 115 |          60 | 2023-11-24 18:02:07 |     2
 116 |          55 | 2023-11-22 09:57:02 |     1
 117 |          55 | 2023-11-22 12:17:03 |     2
 118 |          55 | 2023-11-22 15:36:14 |     1
 119 |          55 | 2023-11-22 19:51:08 |     2
 120 |          55 | 2023-11-25 08:44:48 |     1
 121 |          55 | 2023-11-25 12:56:10 |     2
 122 |          55 | 2023-11-25 15:27:51 |     1
 123 |          55 | 2023-11-25 18:22:20 |     2
 124 |          54 | 2023-11-25 09:02:58 |     1
 125 |          54 | 2023-11-25 12:50:40 |     2
 126 |          54 | 2023-11-25 14:51:23 |     1
 127 |          54 | 2023-11-25 17:27:53 |     2
 128 |          60 | 2023-11-23 10:40:03 |     1
 129 |          60 | 2023-11-23 13:13:40 |     2
 130 |          60 | 2023-11-23 15:25:13 |     1
 131 |          60 | 2023-11-23 20:15:15 |     2
 132 |          51 | 2023-11-20 07:52:39 |     1
 133 |          51 | 2023-11-20 12:28:41 |     2
 134 |          51 | 2023-11-20 13:04:47 |     1
 135 |          51 | 2023-11-20 16:24:48 |     2
 136 |          62 | 2023-11-23 08:20:28 |     1
 137 |          62 | 2023-11-23 12:43:48 |     2
 138 |          62 | 2023-11-23 14:39:50 |     1
 139 |          62 | 2023-11-23 18:12:03 |     2
 140 |          52 | 2023-11-26 09:57:48 |     1
 141 |          52 | 2023-11-26 13:44:57 |     2
 142 |          52 | 2023-11-26 15:26:11 |     1
 143 |          52 | 2023-11-26 17:36:28 |     2
 144 |          57 | 2023-11-21 10:24:18 |     1
 145 |          57 | 2023-11-21 12:06:47 |     2
 146 |          57 | 2023-11-21 14:29:04 |     1
 147 |          57 | 2023-11-21 17:26:14 |     2
 148 |          63 | 2023-11-23 10:45:29 |     1
 149 |          63 | 2023-11-23 11:09:20 |     2
 150 |          63 | 2023-11-23 13:03:39 |     1
 151 |          63 | 2023-11-23 20:23:22 |     2
 152 |          63 | 2023-11-23 06:49:22 |     1
 153 |          63 | 2023-11-23 12:10:02 |     2
 154 |          63 | 2023-11-23 13:22:38 |     1
 155 |          63 | 2023-11-23 20:52:24 |     2
 156 |          60 | 2023-11-22 10:10:01 |     1
 157 |          60 | 2023-11-22 12:51:30 |     2
 158 |          60 | 2023-11-22 14:26:00 |     1
 159 |          60 | 2023-11-22 18:41:47 |     2
 160 |          64 | 2023-11-23 06:55:52 |     1
 161 |          64 | 2023-11-23 12:24:46 |     2
 162 |          64 | 2023-11-23 13:43:11 |     1
 163 |          64 | 2023-11-23 17:36:11 |     2
 164 |          61 | 2023-11-23 09:26:46 |     1
 165 |          61 | 2023-11-23 13:03:33 |     2
 166 |          61 | 2023-11-23 15:20:15 |     1
 167 |          61 | 2023-11-23 19:29:24 |     2
 168 |          55 | 2023-11-25 10:55:53 |     1
 169 |          55 | 2023-11-25 13:41:57 |     2
 170 |          55 | 2023-11-25 14:21:16 |     1
 171 |          55 | 2023-11-25 18:09:44 |     2
 172 |          55 | 2023-11-26 08:48:47 |     1
 173 |          55 | 2023-11-26 12:02:39 |     2
 174 |          55 | 2023-11-26 14:29:51 |     1
 175 |          55 | 2023-11-26 19:19:32 |     2
 176 |          62 | 2023-11-24 07:40:40 |     1
 177 |          62 | 2023-11-24 12:16:27 |     2
 178 |          62 | 2023-11-24 15:50:19 |     1
 179 |          62 | 2023-11-24 20:59:36 |     2
 180 |          60 | 2023-11-21 06:46:11 |     1
 181 |          60 | 2023-11-21 13:29:06 |     2
 182 |          60 | 2023-11-21 14:12:30 |     1
 183 |          60 | 2023-11-21 18:50:50 |     2
 184 |          60 | 2023-11-21 07:52:49 |     1
 185 |          60 | 2023-11-21 11:30:13 |     2
 186 |          60 | 2023-11-21 13:25:51 |     1
 187 |          60 | 2023-11-21 18:14:28 |     2
 188 |          61 | 2023-11-21 08:46:38 |     1
 189 |          61 | 2023-11-21 12:53:16 |     2
 190 |          61 | 2023-11-21 14:31:26 |     1
 191 |          61 | 2023-11-21 18:51:11 |     2
 192 |          55 | 2023-11-24 09:42:17 |     1
 193 |          55 | 2023-11-24 12:18:42 |     2
 194 |          55 | 2023-11-24 15:18:43 |     1
 195 |          55 | 2023-11-24 18:42:08 |     2
 196 |          53 | 2023-11-20 07:41:53 |     1
 197 |          53 | 2023-11-20 11:04:31 |     2
 198 |          53 | 2023-11-20 13:05:34 |     1
 199 |          53 | 2023-11-20 19:26:38 |     2
 200 |          52 | 2023-11-24 07:10:25 |     1
 201 |          52 | 2023-11-24 13:27:47 |     2
 202 |          52 | 2023-11-24 15:41:42 |     1
 203 |          52 | 2023-11-24 18:47:57 |     2
 204 |          58 | 2023-11-20 10:13:54 |     1
 205 |          58 | 2023-11-20 11:50:39 |     2
 206 |          58 | 2023-11-20 13:51:14 |     1
 207 |          58 | 2023-11-20 18:18:07 |     2
 208 |          57 | 2023-11-23 10:21:21 |     1
 209 |          57 | 2023-11-23 12:42:43 |     2
 210 |          57 | 2023-11-23 14:50:14 |     1
 211 |          57 | 2023-11-23 16:33:47 |     2
 212 |          60 | 2023-11-24 09:48:45 |     1
 213 |          60 | 2023-11-24 12:42:44 |     2
 214 |          60 | 2023-11-24 14:02:07 |     1
 215 |          60 | 2023-11-24 18:02:01 |     2
 216 |          52 | 2023-11-23 09:20:22 |     1
 217 |          52 | 2023-11-23 13:34:44 |     2
 218 |          52 | 2023-11-23 13:07:21 |     1
 219 |          52 | 2023-11-23 18:18:34 |     2
 220 |          61 | 2023-11-26 08:43:31 |     1
 221 |          61 | 2023-11-26 13:53:36 |     2
 222 |          61 | 2023-11-26 15:55:25 |     1
 223 |          61 | 2023-11-26 20:03:28 |     2
 224 |          64 | 2023-11-24 07:13:29 |     1
 225 |          64 | 2023-11-24 12:37:31 |     2
 226 |          64 | 2023-11-24 15:33:24 |     1
 227 |          64 | 2023-11-24 19:01:28 |     2
 228 |          57 | 2023-11-21 09:07:09 |     1
 229 |          57 | 2023-11-21 12:01:12 |     2
 230 |          57 | 2023-11-21 14:23:15 |     1
 231 |          57 | 2023-11-21 17:30:04 |     2
 232 |          55 | 2023-11-22 09:25:10 |     1
 233 |          55 | 2023-11-22 13:38:19 |     2
 234 |          55 | 2023-11-22 14:49:30 |     1
 235 |          55 | 2023-11-22 17:51:58 |     2
 236 |          54 | 2023-11-25 06:10:32 |     1
 237 |          54 | 2023-11-25 12:35:31 |     2
 238 |          54 | 2023-11-25 13:53:46 |     1
 239 |          54 | 2023-11-25 18:00:45 |     2
 240 |          50 | 2023-11-22 07:59:48 |     1
 241 |          50 | 2023-11-22 12:22:39 |     2
 242 |          50 | 2023-11-22 13:43:38 |     1
 243 |          50 | 2023-11-22 17:44:23 |     2
 244 |          62 | 2023-11-25 07:48:03 |     1
 245 |          62 | 2023-11-25 12:43:02 |     2
 246 |          62 | 2023-11-25 15:52:16 |     1
 247 |          62 | 2023-11-25 18:37:51 |     2
 248 |          53 | 2023-11-22 10:32:04 |     1
 249 |          53 | 2023-11-22 11:52:32 |     2
 250 |          53 | 2023-11-22 13:20:53 |     1
 251 |          53 | 2023-11-22 16:58:38 |     2
 252 |          59 | 2023-11-21 08:27:18 |     1
 253 |          59 | 2023-11-21 13:01:42 |     2
 254 |          59 | 2023-11-21 15:11:38 |     1
 255 |          59 | 2023-11-21 19:57:23 |     2
 256 |          50 | 2023-11-23 08:06:20 |     1
 257 |          50 | 2023-11-23 12:54:52 |     2
 258 |          50 | 2023-11-23 14:34:29 |     1
 259 |          50 | 2023-11-23 19:48:00 |     2
 260 |          54 | 2023-11-22 09:16:57 |     1
 261 |          54 | 2023-11-22 13:31:13 |     2
 262 |          54 | 2023-11-22 15:26:47 |     1
 263 |          54 | 2023-11-22 20:57:20 |     2
 264 |          60 | 2023-11-24 07:06:32 |     1
 265 |          60 | 2023-11-24 11:15:47 |     2
 266 |          60 | 2023-11-24 14:10:56 |     1
 267 |          60 | 2023-11-24 19:49:14 |     2
 268 |          55 | 2023-11-22 09:26:28 |     1
 269 |          55 | 2023-11-22 12:33:06 |     2
 270 |          55 | 2023-11-22 15:42:56 |     1
 271 |          55 | 2023-11-22 16:07:22 |     2
 272 |          53 | 2023-11-22 08:45:23 |     1
 273 |          53 | 2023-11-22 13:43:50 |     2
 274 |          53 | 2023-11-22 15:25:25 |     1
 275 |          53 | 2023-11-22 19:56:09 |     2
 276 |          56 | 2023-11-21 08:45:18 |     1
 277 |          56 | 2023-11-21 11:05:27 |     2
 278 |          56 | 2023-11-21 14:53:39 |     1
 279 |          56 | 2023-11-21 19:48:37 |     2
 280 |          51 | 2023-11-24 09:19:07 |     1
 281 |          51 | 2023-11-24 13:47:18 |     2
 282 |          51 | 2023-11-24 13:35:40 |     1
 283 |          51 | 2023-11-24 16:18:52 |     2
 284 |          54 | 2023-11-25 06:34:17 |     1
 285 |          54 | 2023-11-25 12:25:24 |     2
 286 |          54 | 2023-11-25 14:47:38 |     1
 287 |          54 | 2023-11-25 17:34:20 |     2
 288 |          54 | 2023-11-22 08:04:18 |     1
 289 |          54 | 2023-11-22 12:27:53 |     2
 290 |          54 | 2023-11-22 13:17:04 |     1
 291 |          54 | 2023-11-22 18:39:50 |     2
 292 |          52 | 2023-11-24 10:03:38 |     1
 293 |          52 | 2023-11-24 13:55:09 |     2
 294 |          52 | 2023-11-24 14:41:31 |     1
 295 |          52 | 2023-11-24 17:33:03 |     2
 296 |          57 | 2023-11-22 08:14:55 |     1
 297 |          57 | 2023-11-22 12:17:13 |     2
 298 |          57 | 2023-11-22 14:52:21 |     1
 299 |          57 | 2023-11-22 18:17:20 |     2
 300 |          61 | 2023-11-22 06:46:57 |     1
 301 |          61 | 2023-11-22 12:44:33 |     2
 302 |          61 | 2023-11-22 15:57:17 |     1
 303 |          61 | 2023-11-22 17:49:08 |     2
 304 |          59 | 2023-11-21 08:20:34 |     1
 305 |          59 | 2023-11-21 11:44:20 |     2
 306 |          59 | 2023-11-21 15:55:14 |     1
 307 |          59 | 2023-11-21 16:04:44 |     2
 308 |          62 | 2023-11-22 09:19:59 |     1
 309 |          62 | 2023-11-22 13:14:54 |     2
 310 |          62 | 2023-11-22 14:57:21 |     1
 311 |          62 | 2023-11-22 16:25:14 |     2
 312 |          59 | 2023-11-26 10:43:31 |     1
 313 |          59 | 2023-11-26 11:13:25 |     2
 314 |          59 | 2023-11-26 15:56:57 |     1
 315 |          59 | 2023-11-26 19:11:35 |     2
 316 |          51 | 2023-11-24 08:44:46 |     1
 317 |          51 | 2023-11-24 12:21:41 |     2
 318 |          51 | 2023-11-24 14:15:50 |     1
 319 |          51 | 2023-11-24 16:46:02 |     2
 320 |          54 | 2023-11-21 07:27:17 |     1
 321 |          54 | 2023-11-21 12:34:17 |     2
 322 |          54 | 2023-11-21 15:54:33 |     1
 323 |          54 | 2023-11-21 19:48:38 |     2
 324 |          61 | 2023-11-25 09:40:28 |     1
 325 |          61 | 2023-11-25 11:29:12 |     2
 326 |          61 | 2023-11-25 15:10:35 |     1
 327 |          61 | 2023-11-25 19:42:17 |     2
 328 |          64 | 2023-11-26 09:15:39 |     1
 329 |          64 | 2023-11-26 11:31:58 |     2
 330 |          64 | 2023-11-26 13:35:08 |     1
 331 |          64 | 2023-11-26 18:03:46 |     2
 332 |          55 | 2023-11-23 07:39:19 |     1
 333 |          55 | 2023-11-23 13:01:12 |     2
 334 |          55 | 2023-11-23 13:39:10 |     1
 335 |          55 | 2023-11-23 17:26:29 |     2
 336 |          51 | 2023-11-22 09:39:06 |     1
 337 |          51 | 2023-11-22 12:57:22 |     2
 338 |          51 | 2023-11-22 14:29:46 |     1
 339 |          51 | 2023-11-22 18:19:54 |     2
 340 |          64 | 2023-11-22 09:08:17 |     1
 341 |          64 | 2023-11-22 12:40:26 |     2
 342 |          64 | 2023-11-22 14:32:25 |     1
 343 |          64 | 2023-11-22 19:41:27 |     2
 344 |          65 | 2023-11-21 10:42:16 |     1
 345 |          65 | 2023-11-21 12:09:36 |     2
 346 |          65 | 2023-11-21 14:02:22 |     1
 347 |          65 | 2023-11-21 16:41:48 |     2
 348 |          59 | 2023-11-25 06:21:37 |     1
 349 |          59 | 2023-11-25 12:16:54 |     2
 350 |          59 | 2023-11-25 15:04:11 |     1
 351 |          59 | 2023-11-25 17:48:18 |     2
 352 |          58 | 2023-11-22 07:03:26 |     1
 353 |          58 | 2023-11-22 13:18:47 |     2
 354 |          58 | 2023-11-22 13:07:24 |     1
 355 |          58 | 2023-11-22 19:26:29 |     2
 356 |          57 | 2023-11-25 06:57:15 |     1
 357 |          57 | 2023-11-25 13:39:41 |     2
 358 |          57 | 2023-11-25 15:00:36 |     1
 359 |          57 | 2023-11-25 16:56:50 |     2
 360 |          51 | 2023-11-23 08:03:50 |     1
 361 |          51 | 2023-11-23 12:10:15 |     2
 362 |          51 | 2023-11-23 13:10:30 |     1
 363 |          51 | 2023-11-23 19:10:07 |     2
 364 |          59 | 2023-11-22 08:20:04 |     1
 365 |          59 | 2023-11-22 13:24:47 |     2
 366 |          59 | 2023-11-22 14:02:14 |     1
 367 |          59 | 2023-11-22 19:12:51 |     2
 368 |          51 | 2023-11-24 09:51:17 |     1
 369 |          51 | 2023-11-24 12:32:52 |     2
 370 |          51 | 2023-11-24 13:50:27 |     1
 371 |          51 | 2023-11-24 19:47:01 |     2
 372 |          58 | 2023-11-26 08:03:36 |     1
 373 |          58 | 2023-11-26 13:45:37 |     2
 374 |          58 | 2023-11-26 14:35:18 |     1
 375 |          58 | 2023-11-26 19:37:38 |     2
 376 |          65 | 2023-11-26 10:27:01 |     1
 377 |          65 | 2023-11-26 12:53:36 |     2
 378 |          65 | 2023-11-26 15:08:37 |     1
 379 |          65 | 2023-11-26 19:41:55 |     2
 380 |          64 | 2023-11-24 07:38:09 |     1
 381 |          64 | 2023-11-24 13:05:03 |     2
 382 |          64 | 2023-11-24 14:36:41 |     1
 383 |          64 | 2023-11-24 19:44:53 |     2
 384 |          52 | 2023-11-23 07:26:47 |     1
 385 |          52 | 2023-11-23 12:24:12 |     2
 386 |          52 | 2023-11-23 14:40:39 |     1
 387 |          52 | 2023-11-23 19:06:07 |     2
 388 |          60 | 2023-11-25 07:15:31 |     1
 389 |          60 | 2023-11-25 12:41:18 |     2
 390 |          60 | 2023-11-25 14:27:03 |     1
 391 |          60 | 2023-11-25 17:57:02 |     2
 392 |          63 | 2023-11-25 07:44:50 |     1
 393 |          63 | 2023-11-25 11:22:35 |     2
 394 |          63 | 2023-11-25 15:33:16 |     1
 395 |          63 | 2023-11-25 19:24:19 |     2
 396 |          57 | 2023-11-26 09:16:54 |     1
 397 |          57 | 2023-11-26 12:48:44 |     2
 398 |          57 | 2023-11-26 14:56:22 |     1
 399 |          57 | 2023-11-26 19:38:39 |     2
 400 |          52 | 2023-11-23 07:46:04 |     1
 401 |          52 | 2023-11-23 12:28:58 |     2
 402 |          52 | 2023-11-23 13:54:45 |     1
 403 |          52 | 2023-11-23 18:11:07 |     2
(404 строки)

2:

WITH x AS (SELECT *, (CASE
		WHEN VALUE = 2 THEN TIME_OF_TRANSFER::TIME::INTERVAL - (LAG(TIME_OF_TRANSFER) OVER())::TIME
		ELSE 'allballs'::TIME::INTERVAL
	END) hR FROM WORKING_DAY WHERE EMPLOYEE_ID = 62 ORDER BY id DESC)
	SELECT EMPLOYEE_ID, extract(hour from SUM(hr)) FROM x GROUP BY EMPLOYEE_ID;

SELECT EMPLOYEE_ID, COUNT(*) FROM WORKING_DAY GROUP BY EMPLOYEE_ID;

CREATE OR REPLACE FUNCTION getInfo7_2(idEMP BIGINT)
RETURNS TABLE(hrINT BIGINT, message TEXT) AS $$
DECLARE
	hrINT BIGINT;
	message TEXT;
BEGIN
	DROP TABLE IF EXISTS x;
	create temporary table x as SELECT *, (CASE
		WHEN VALUE = 2 THEN TIME_OF_TRANSFER::TIME::INTERVAL - (LAG(TIME_OF_TRANSFER) OVER())::TIME
		ELSE 'allballs'::TIME::INTERVAL
	END) hR FROM WORKING_DAY WHERE EMPLOYEE_ID = idEMP ORDER BY id DESC;
	hrINT := (SELECT extract(hour from SUM(hr)) FROM x);
	message := (SELECT CASE
		WHEN hrINT < 40 THEN 'Меньше нормы'
		WHEN hrINT > 40 THEN 'Больше нормы'
		ELSE 'Норма'
	END);
	RETURN query (SELECT hrINT, message);
END $$ language plpgsql;

SELECT * FROM getInfo7_2(62);

DROP FUNCTION getInfo7_2(idEMP BIGINT);

3:

SELECT *, (CASE
		WHEN MOD(ID, 4) = 2 THEN TIME_OF_TRANSFER::TIME::INTERVAL - (LAG(TIME_OF_TRANSFER) OVER())::TIME
		ELSE 'allballs'::TIME::INTERVAL
	END) hR FROM WORKING_DAY WHERE EMPLOYEE_ID = 62 ORDER BY id DESC;

CREATE OR REPLACE FUNCTION getInfo7_3(idEMP BIGINT)
RETURNS TIME AS $$
BEGIN
	DROP TABLE IF EXISTS x;
	create temporary table x as SELECT *, (CASE
		WHEN MOD(ID, 4) = 2 THEN TIME_OF_TRANSFER::TIME::INTERVAL - (LAG(TIME_OF_TRANSFER) OVER())::TIME
		ELSE 'allballs'::TIME::INTERVAL
	END) hR FROM WORKING_DAY WHERE EMPLOYEE_ID = idEMP ORDER BY id DESC;
	RETURN (SELECT SUM(hr) FROM x);
END $$ language plpgsql;

SELECT * FROM getInfo7_3(62);

SELECT * FROM getInfo7_3(66);

DROP FUNCTION getInfo7_3(idEMP BIGINT);

4:

SELECT *, (CASE
		WHEN MOD(ID, 4) = 0 THEN TIME_OF_TRANSFER::TIME - INTERVAL '9 hours'
		WHEN MOD(ID, 4) = 1 THEN '13 hours'::INTERVAL::TIME - TIME_OF_TRANSFER::TIME::INTERVAL
		WHEN MOD(ID, 4) = 2 THEN TIME_OF_TRANSFER::TIME - INTERVAL '14 hours'
		WHEN MOD(ID, 4) = 3 THEN '18 hours'::INTERVAL::TIME - TIME_OF_TRANSFER::TIME::INTERVAL
	END) hR FROM WORKING_DAY WHERE EMPLOYEE_ID = 62;

CREATE OR REPLACE FUNCTION getEmp7_4(idEMP BIGINT)
RETURNS TIME AS $$
BEGIN
	DROP TABLE IF EXISTS x, x1;
	create temporary table x as SELECT *, (CASE
		WHEN MOD(ID, 4) = 0 THEN TIME_OF_TRANSFER::TIME - INTERVAL '9 hours'
		WHEN MOD(ID, 4) = 1 THEN '13 hours'::INTERVAL::TIME - TIME_OF_TRANSFER::TIME::INTERVAL
		WHEN MOD(ID, 4) = 2 THEN TIME_OF_TRANSFER::TIME - INTERVAL '14 hours'
		WHEN MOD(ID, 4) = 3 THEN '18 hours'::INTERVAL::TIME - TIME_OF_TRANSFER::TIME::INTERVAL
	END) hR FROM WORKING_DAY WHERE EMPLOYEE_ID = idEMP;
	create temporary table x1 as SELECT x.id, x.EMPLOYEE_ID, x.TIME_OF_TRANSFER, x.VALUE, (CASE
		WHEN x.hR > (interval '15 hours') THEN 'allballs'::TIME
		ELSE x.hR
	END) hR FROM x;
	RETURN (SELECT SUM(hr) FROM x1);
END $$ language plpgsql;

CREATE OR REPLACE FUNCTION getInfo7_4()
RETURNS TABLE(EMPLOYEE_ID BIGINT, tim TIME) AS $$
BEGIN
	RETURN query(SELECT w.EMPLOYEE_ID, getEmp7_4(w.EMPLOYEE_ID) tim FROM WORKING_DAY w GROUP BY w.EMPLOYEE_ID ORDER BY tim DESC limit 5);
END $$ language plpgsql;

SELECT * FROM getInfo7_4();

DROP FUNCTION getInfo7_4();

5:

CREATE OR REPLACE FUNCTION interval_div(TIME, interval) RETURNS BIGINT AS $$
  SELECT EXTRACT(EPOCH FROM $1) / EXTRACT(EPOCH FROM $2)
$$ LANGUAGE SQL;

CREATE OPERATOR / (
   FUNCTION = interval_div,
   LEFTARG = TIME,
   RIGHTARG = interval);

CREATE OR REPLACE FUNCTION getInfo7_5(SALARY BIGINT)
RETURNS TABLE(EMPLOYEE_ID BIGINT, tim TIME, pay FLOAT) AS $$
BEGIN
	RETURN query(SELECT w.EMPLOYEE_ID, getEmp7_4(w.EMPLOYEE_ID) tim, (SALARY + SALARY * (1 - (getEmp7_4(w.EMPLOYEE_ID) / INTERVAL '10 minutes') * 0.005))::FLOAT FROM WORKING_DAY w GROUP BY w.EMPLOYEE_ID ORDER BY tim);
END $$ language plpgsql;

SELECT * FROM getInfo7_5(25000);

DROP FUNCTION getInfo7_5(SALARY BIGINT);

DROP FUNCTION interval_div(TIME, interval) CASCADE;

6:

SELECT EXTRACT(DAY FROM TIME_OF_TRANSFER) d, COUNT(*) FROM WORKING_DAY GROUP BY d ORDER BY d;

SELECT FORMAT('%1$s:00:00-%1$s:59:59', EXTRACT(HOUR FROM TIME_OF_TRANSFER)) h, COUNT(*) FROM WORKING_DAY WHERE EXTRACT(DAY FROM TIME_OF_TRANSFER) = 21 GROUP BY h;

CREATE OR REPLACE FUNCTION getInfo7_6(DAY TIMESTAMP)
RETURNS TABLE(h TEXT, COUNT BIGINT) AS $$
BEGIN
	DROP TABLE IF EXISTS x;
	create temporary table x as SELECT EXTRACT(HOUR FROM TIME_OF_TRANSFER) hINT, COUNT(*) cnt FROM WORKING_DAY WHERE EXTRACT(DAY FROM TIME_OF_TRANSFER) = EXTRACT(DAY FROM DAY) GROUP BY hINT;
	RETURN query(SELECT FORMAT('%1$s:00:00-%1$s:59:59', x.hINT) h, x.cnt FROM x ORDER BY x.hINT);
END $$ language plpgsql;

SELECT * FROM getInfo7_6('2023-11-21');

DROP FUNCTION getInfo7_6(DAY TIMESTAMP);
