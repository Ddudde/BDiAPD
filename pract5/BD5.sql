Создание БД:

1:
CREATE DATABASE realty;

\c realty;

CREATE TABLE AREA (
	ID BIGINT PRIMARY KEY,
	NAME CHARACTER(30)
);

INSERT INTO AREA VALUES
(0, 'Центр'),
(1, 'Таганский'),
(2, 'Тушино')
RETURNING ID;

2:
CREATE TABLE REALTY_OBJECT (
	ID BIGINT PRIMARY KEY,
	AREA_ID BIGINT REFERENCES AREA (ID),
	ADDRESS CHARACTER(30),
	FLOOOR BIGINT,
	COUNT_ROOMS BIGINT,
	TYPE_OBJECT BIGINT,
	STATE_OBJECT BIGINT,
	PRICE double precision,
	DESCRIPTION TEXT,
	THE_AREA double precision,
	DATE_OF_ANNOUNCEMENT timestamp
);

INSERT INTO REALTY_OBJECT VALUES
(3, 0, 'г. Москва, ул. Донская, д. 8 стр. 1', 1, 5, 0, 0, 12000000, 'Уютная студия с открытой планировкой, минималистичным дизайном и современными удобствами. Имеется небольшая кухня, спальная зона и ванная комната. Отличный вариант для одного или двух человек.', 25, '2016-07-22'),
(4, 1, 'г. Москва, ул. Тверская, д. 1', 2, 6, 1, 1, 17000000, 'Просторная квартира с двумя отдельными комнатами, гостиная, полностью оборудованная кухня и ванная комната. Имеется балкон с видом на город. Отличный вариант для семьи или группы друзей.', 50, '2019-01-22'),
(5, 2, 'г. Москва, ул. Снайперская д. 4', 15, 10, 0, 1, 20000000, 'Роскошный пентхаус с просторными и роскошными интерьерами. Три спальни, просторная гостиная, полностью оборудованная кухня, несколько ванных комнат и большая терраса с потрясающим видом на город. Идеальный выбор для проживания в стиле VIP.', 100, '2021-12-22')
RETURNING ID;

3:
CREATE TABLE ASSESSMENT_CRITERION (
	ID BIGINT PRIMARY KEY,
	NAME CHARACTER(30)
);

INSERT INTO ASSESSMENT_CRITERION VALUES
(6, 'Площадь'),
(7, 'Цена'),
(8, 'Дата')
RETURNING ID;

4:
CREATE TABLE SCORE (
	ID BIGINT PRIMARY KEY,
	REALTY_OBJECT_ID BIGINT REFERENCES REALTY_OBJECT (ID),
	DATE_OF_SCORE timestamp,
	ASSESSMENT_CRITERION_ID BIGINT REFERENCES ASSESSMENT_CRITERION (ID),
	VALUE double precision
);

INSERT INTO SCORE VALUES
(9, 3, '2016-07-22', 6, 10),
(10, 4, '2019-01-22', 8, 7),
(11, 5, '2021-12-22', 7, 2)
RETURNING ID;

5:
CREATE TABLE REALTOR (
	ID BIGINT PRIMARY KEY,
	LAST_NAME CHARACTER(15),
	FIRST_NAME CHARACTER(15),
	PATRONYMIC CHARACTER(15),
	PHONE CHARACTER(15)
);

INSERT INTO REALTOR VALUES
(12, 'Дорохов', 'Владимир', 'Александрович', '+7 (495) 727 77 77'),
(13, 'Зубенко', 'Михаил', 'Петрович', '+7 (926) 333 31 10'),
(14, 'Мякина', 'Наталья', 'Валерьевна', '+7 (999) 878 78 78')
RETURNING ID;

6:
CREATE TABLE SALE (
	ID BIGINT PRIMARY KEY,
	REALTY_OBJECT_ID BIGINT REFERENCES REALTY_OBJECT (ID),
	DATE_OF_SALE timestamp,
	REALTOR_ID BIGINT REFERENCES REALTOR (ID),
	PRICE double precision
);

INSERT INTO SALE VALUES
(15, 3, '2016-07-23', 12, 11999999),
(16, 4, '2019-01-23', 13, 16999999),
(17, 5, '2021-12-23', 14, 19999999)
RETURNING ID;

Поправки:

ALTER TABLE REALTY_OBJECT ALTER COLUMN ADDRESS TYPE CHARACTER(40);

ALTER TABLE REALTOR ALTER COLUMN PHONE TYPE CHARACTER(20);

ALTER TABLE REALTY_OBJECT ALTER COLUMN ADDRESS TYPE CHARACTER(80);

Тест:

INSERT INTO AREA
SELECT (i + 17), (faker.street_title() || ' sdf') from generate_series(1,5) i
RETURNING *;

 id |              name
----+--------------------------------
 26 | Льва Толстого
 27 | Ключевая
 28 | Тукая
 29 | Ивановская
 30 | Чайкиной
(5 строк)


INSERT 0 5

delete FROM AREA WHERE ID>15;

Запросы:

1: 

Дополнительная генерация данных:

SELECT faker.faker('ru_RU');

INSERT INTO REALTY_OBJECT
SELECT (i + 22), 1, 'г. Москва, ' || faker.address(), rand(1, 25), rand(1, 10), rand(),
	0, rand(10000000, 20000000), faker.text(), rand(10, 150),
	faker.date_between('-50y')::timestamp from generate_series(1,1) i
RETURNING *;

 id | area_id |                                address                                 | flooor | count_rooms | type_object | state_object |  price   |                                                                          description                                                                           | the_area | date_of_announcement
----+---------+------------------------------------------------------------------------+--------+-------------+-------------+--------------+----------+----------------------------------------------------------------------------------------------------------------------------------------------------------------+----------+----------------------
 18 |       1 | г. Москва, д. Середниково, алл. Баумана, д. 9/8 стр. 410, 850150       |     14 |           2 |           1 |            0 | 15815451 | Командование похороны плясать славный зачем. Спасть развернуться экзамен неправда домашний эффект.                                                            +|       26 | 2000-01-25 00:00:00
    |         |                                                                        |        |             |             |              |          | Банда увеличиваться нож. Секунда поставить поколение рота.                                                                                                     |          |
 19 |       1 | г. Москва, г. Мытищи, наб. Победы, д. 65, 114904                       |      8 |           8 |           0 |            0 | 12043979 | Невозможно рис жить неожиданно роскошный. Гулять миллиард грудь секунда трясти страсть коричневый естественный. Миллиард грустный прошептать прежний добиться. |       82 | 2007-12-08 00:00:00
 20 |       1 | г. Москва, ст. Ростов, пр. Транспортный, д. 4/7 к. 2/2, 355610         |     22 |           5 |           0 |            0 | 15122672 | Посидеть запеть теория конференция успокоиться.                                                                                                               +|      146 | 1990-12-02 00:00:00
    |         |                                                                        |        |             |             |              |          | Гулять лапа дошлый господь место. Рай предоставить очко премьера. Мусор изображать плод монета трубка.                                                         |          |
 21 |       1 | г. Москва, с. Артем, ул. Производственная, д. 3/2, 271594              |      2 |           4 |           1 |            0 | 14005999 | Армейский неожиданный чувство промолчать роса эффект тусклый ломать. Стакан налево равнодушный висеть спичка материя.                                          |      118 | 1975-03-14 00:00:00
 22 |       1 | г. Москва, клх Стерлитамак, пр. Ангарский, д. 25, 500127               |     22 |           5 |           1 |            0 | 19298401 | Желание тюрьма ручей. Ленинград район при. Равнодушный намерение мальчишка песня отметить. Упорно печатать приятель ложиться плод развитый славный.            |       47 | 1978-09-25 00:00:00
(5 строк)

INSERT 0 5

 id | area_id |                                address                                 | flooor | count_rooms | type_object | state_object |  price   |                                                   description                                                   | the_area | date_of_announcement
----+---------+------------------------------------------------------------------------+--------+-------------+-------------+--------------+----------+-----------------------------------------------------------------------------------------------------------------+----------+----------------------
 23 |       1 | г. Москва, д. Каспийск, бул. Пожарского, д. 4/3 стр. 839, 030781       |     16 |           8 |           0 |            0 | 11867551 | Манера изредка лететь госпожа висеть нервно. Мрачно построить легко присесть остановить белье заложить полоска.+|       51 | 2011-07-30 00:00:00
    |         |                                                                        |        |             |             |              |          | Прошептать около слишком зато. Некоторый запеть научить.                                                        |          |
(1 строка)

INSERT 0 1

delete FROM REALTY_OBJECT WHERE ID>22;

Запрос:

--SELECT * FROM (SELECT a, r FROM REALTY_OBJECT r, AREA a WHERE r.AREA_ID = a.ID) x;

WITH x as (SELECT a, r, RND((r).PRICE / (r).THE_AREA, 2) p_to_m2 FROM REALTY_OBJECT r, AREA a WHERE r.AREA_ID = a.ID),
	x1 as (SELECT a, RND(AVG((r).PRICE / (r).THE_AREA), 2) avg FROM x GROUP BY a)
	SELECT x1, (r).ADDRESS, p_to_m2 FROM x NATURAL INNER JOIN x1 WHERE p_to_m2 < x1.avg GROUP BY x1, r, p_to_m2;

2:

SELECT a, COUNT(r) FROM REALTY_OBJECT r, AREA a WHERE r.AREA_ID = a.ID AND (r).STATE_OBJECT = 0 GROUP BY a HAVING COUNT(r) > 5;

3:
Поправка:

SELECT * FROM SCORE;

UPDATE SCORE SET VALUE = rand(1, 5) WHERE true;

Дополнительная генерация данных:

--SELECT x.id FROM (SELECT r.id FROM REALTY_OBJECT r ORDER BY random() LIMIT 1) x(id);

--SELECT * FROM (SELECT r.id FROM REALTY_OBJECT r) x ORDER BY random() LIMIT 1;

--SELECT * FROM (VALUES (1), (2), (3)) x ORDER BY random() LIMIT 1;

SELECT faker.faker('ru_RU');

INSERT INTO SCORE SELECT
	(i + 23), (SELECT r.id FROM REALTY_OBJECT r WHERE i=i ORDER BY random() LIMIT 1),
	faker.date_between('-50y')::timestamp, rand(6, 8), rand(2, 5) FROM generate_series(1,100) i
RETURNING *;

 id  | realty_object_id |    date_of_score    | assessment_criterion_id | value
-----+------------------+---------------------+-------------------------+-------
  24 |                5 | 1997-09-23 00:00:00 |                       7 |     3
  25 |               23 | 2018-11-30 00:00:00 |                       6 |     4
  26 |                5 | 2000-07-05 00:00:00 |                       7 |     3
  27 |               19 | 2009-06-05 00:00:00 |                       7 |     4
  28 |               21 | 1988-08-08 00:00:00 |                       6 |     5
  29 |               22 | 1996-12-02 00:00:00 |                       7 |     4
  30 |               20 | 2008-02-01 00:00:00 |                       8 |     2
  31 |               20 | 2001-03-15 00:00:00 |                       6 |     3
  32 |               19 | 1993-08-26 00:00:00 |                       7 |     3
  33 |               19 | 1980-01-25 00:00:00 |                       6 |     5
  34 |               19 | 1996-10-13 00:00:00 |                       7 |     3
  35 |                5 | 2004-11-13 00:00:00 |                       7 |     4
  36 |               19 | 2009-11-21 00:00:00 |                       7 |     5
  37 |               19 | 2017-01-08 00:00:00 |                       6 |     4
  38 |               23 | 2012-11-26 00:00:00 |                       7 |     3
  39 |               22 | 1985-06-19 00:00:00 |                       6 |     3
  40 |               18 | 2006-11-30 00:00:00 |                       7 |     3
  41 |               19 | 2017-11-22 00:00:00 |                       7 |     2
  42 |                5 | 2011-03-29 00:00:00 |                       6 |     4
  43 |               21 | 2023-10-14 00:00:00 |                       7 |     4
  44 |                4 | 1983-09-29 00:00:00 |                       7 |     4
  45 |               18 | 2013-09-16 00:00:00 |                       6 |     3
  46 |               23 | 1984-03-27 00:00:00 |                       7 |     4
  47 |                5 | 2021-12-22 00:00:00 |                       8 |     4
  48 |               18 | 1998-07-25 00:00:00 |                       6 |     4
  49 |               21 | 2014-06-14 00:00:00 |                       7 |     4
  50 |               23 | 2022-12-19 00:00:00 |                       8 |     5
  51 |               19 | 1976-11-11 00:00:00 |                       7 |     2
  52 |               20 | 2006-11-14 00:00:00 |                       8 |     4
  53 |                3 | 1992-11-23 00:00:00 |                       7 |     2
  54 |               18 | 1977-06-13 00:00:00 |                       6 |     3
  55 |               18 | 2001-10-02 00:00:00 |                       7 |     3
  56 |               22 | 2001-04-09 00:00:00 |                       7 |     4
  57 |               23 | 1975-05-18 00:00:00 |                       6 |     2
  58 |                5 | 1988-03-13 00:00:00 |                       7 |     4
  59 |                3 | 2015-03-15 00:00:00 |                       6 |     3
  60 |               19 | 2008-05-31 00:00:00 |                       6 |     4
  61 |                3 | 1993-04-22 00:00:00 |                       7 |     3
  62 |                3 | 2002-12-16 00:00:00 |                       7 |     2
  63 |               23 | 2003-07-05 00:00:00 |                       8 |     3
  64 |               21 | 2017-05-14 00:00:00 |                       8 |     3
  65 |               20 | 2016-04-11 00:00:00 |                       7 |     5
  66 |                4 | 2020-11-15 00:00:00 |                       6 |     4
  67 |                3 | 2023-05-03 00:00:00 |                       6 |     2
  68 |                5 | 2008-06-17 00:00:00 |                       8 |     3
  69 |               22 | 2013-08-28 00:00:00 |                       7 |     3
  70 |                4 | 1976-12-15 00:00:00 |                       7 |     5
  71 |               18 | 1996-03-08 00:00:00 |                       7 |     4
  72 |               22 | 1979-01-10 00:00:00 |                       7 |     2
  73 |                3 | 1985-07-01 00:00:00 |                       8 |     3
  74 |                4 | 1991-12-20 00:00:00 |                       7 |     4
  75 |               22 | 1976-09-08 00:00:00 |                       6 |     4
  76 |                5 | 1974-07-07 00:00:00 |                       6 |     4
  77 |               21 | 2014-06-28 00:00:00 |                       7 |     4
  78 |               19 | 1977-10-26 00:00:00 |                       7 |     2
  79 |               19 | 1976-07-21 00:00:00 |                       6 |     2
  80 |               20 | 1993-03-27 00:00:00 |                       8 |     2
  81 |                3 | 2012-09-06 00:00:00 |                       8 |     3
  82 |               18 | 2000-05-16 00:00:00 |                       7 |     4
  83 |                5 | 2009-01-16 00:00:00 |                       7 |     2
  84 |                3 | 2019-08-19 00:00:00 |                       7 |     3
  85 |                5 | 2007-02-01 00:00:00 |                       8 |     3
  86 |                4 | 1978-03-20 00:00:00 |                       7 |     3
  87 |               18 | 2011-07-04 00:00:00 |                       8 |     4
  88 |               23 | 1977-04-17 00:00:00 |                       7 |     3
  89 |               20 | 2009-05-12 00:00:00 |                       8 |     4
  90 |                4 | 1992-09-03 00:00:00 |                       7 |     2
  91 |               19 | 1995-03-01 00:00:00 |                       6 |     2
  92 |               18 | 2002-09-21 00:00:00 |                       8 |     5
  93 |               18 | 1992-03-15 00:00:00 |                       6 |     3
  94 |                5 | 2015-05-31 00:00:00 |                       7 |     3
  95 |               19 | 2009-09-05 00:00:00 |                       7 |     3
  96 |               21 | 2014-04-29 00:00:00 |                       7 |     5
  97 |                5 | 2021-02-16 00:00:00 |                       8 |     2
  98 |               18 | 1983-03-13 00:00:00 |                       7 |     3
  99 |               21 | 1980-02-08 00:00:00 |                       7 |     3
 100 |               19 | 2010-03-05 00:00:00 |                       7 |     3
 101 |               20 | 1987-05-07 00:00:00 |                       7 |     2
 102 |               19 | 1976-12-23 00:00:00 |                       8 |     3
 103 |               20 | 1994-03-19 00:00:00 |                       8 |     4
 104 |               19 | 1974-11-17 00:00:00 |                       7 |     3
 105 |               19 | 1997-03-06 00:00:00 |                       7 |     2
 106 |                4 | 1994-01-25 00:00:00 |                       6 |     3
 107 |                5 | 2022-07-25 00:00:00 |                       6 |     4
 108 |               21 | 1997-12-02 00:00:00 |                       8 |     3
 109 |               18 | 1993-03-28 00:00:00 |                       7 |     3
 110 |               23 | 2014-04-30 00:00:00 |                       8 |     3
 111 |               21 | 2005-04-22 00:00:00 |                       7 |     4
 112 |               19 | 1995-03-15 00:00:00 |                       7 |     5
 113 |               19 | 2002-04-06 00:00:00 |                       6 |     3
 114 |               18 | 1995-12-15 00:00:00 |                       7 |     2
 115 |               20 | 1977-11-27 00:00:00 |                       7 |     5
 116 |                4 | 2002-12-27 00:00:00 |                       7 |     4
 117 |               23 | 1984-01-27 00:00:00 |                       6 |     4
 118 |                5 | 1978-07-11 00:00:00 |                       7 |     4
 119 |               19 | 2004-08-17 00:00:00 |                       7 |     2
 120 |               18 | 1991-05-14 00:00:00 |                       8 |     2
 121 |               18 | 2013-12-10 00:00:00 |                       7 |     3
 122 |               19 | 2009-08-07 00:00:00 |                       7 |     4
 123 |                4 | 1980-03-29 00:00:00 |                       7 |     4
(100 строк)

INSERT 0 100

delete FROM SCORE WHERE ID>22;

Запрос:

WITH x as (SELECT s.REALTY_OBJECT_ID realId, RND(AVG(s.VALUE), 2) avg, r, a FROM Score s, REALTY_OBJECT r, AREA a WHERE s.REALTY_OBJECT_ID = r.ID AND r.AREA_ID = a.ID GROUP BY s.REALTY_OBJECT_ID, r, a)
	SELECT x.realId, x.avg, (x.a).NAME, (x.r).ADDRESS FROM x WHERE x.avg > 3.5;

4:

Дополнительная генерация данных(REALTY_OBJECT):

SELECT faker.faker('ru_RU');

INSERT INTO REALTY_OBJECT
SELECT (i + 123), 1, 'г. Москва, ' || faker.address(), rand(1, 25), rand(1, 10), rand(),
	0, rand(10000000, 20000000), faker.text(), rand(10, 150),
	faker.date_between('-20y')::timestamp from generate_series(1,20) i
RETURNING *;

 id  | area_id |                                address                                 | flooor | count_rooms | type_object | state_object |  price   |                                                                                   description                                                                                    | the_area | date_of_announcement
-----+---------+------------------------------------------------------------------------+--------+-------------+-------------+--------------+----------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------+----------------------
 124 |       1 | г. Москва, ст. Долинск, пер. Микрорайон, д. 6, 730295                  |      2 |           7 |           0 |            0 | 19993181 | Кидать порог изучить экзамен второй. Правление тревога за приятель сохранять коллектив.                                                                                         +|       15 | 2015-12-03 00:00:00
     |         |                                                                        |        |             |             |              |          | Правильный ныне пробовать решетка. Налоговый выгнать передо.                                                                                                                     |          |
 125 |       1 | г. Москва, д. Верхнее Пенжино, пр. 40 лет Победы, д. 47 к. 5/7, 683305 |      1 |           9 |           0 |            0 | 16834300 | Пробовать успокоиться материя ботинок налево покидать выражение. Обида предоставить место монета банда сутки сверкать.                                                           |       20 | 2019-01-15 00:00:00
 126 |       1 | г. Москва, п. Беломорск, бул. Шолохова, д. 21 к. 58, 315783            |      9 |           5 |           1 |            0 | 17708329 | Неудобно поймать войти цель песня выраженный сынок горький. Освобождение выбирать помимо второй рота роса.                                                                      +|       73 | 2020-03-19 00:00:00
     |         |                                                                        |        |             |             |              |          | Задержать бабочка покинуть запретить.                                                                                                                                            |          |
 127 |       1 | г. Москва, к. Соликамск, ул. 8 Марта, д. 21 стр. 8/5, 003972           |     18 |           5 |           1 |            0 | 13496905 | Бетонный печатать единый невозможно желание пасть полоска. Выраженный коробка магазин успокоиться кожа мотоцикл.                                                                 |       26 | 2004-12-04 00:00:00
 128 |       1 | г. Москва, д. Пушкин, пр. Советов, д. 3, 290362                        |     23 |           8 |           0 |            0 | 12472286 | Устройство задрать приличный построить указанный. Подземный наступать изба радость заведение покидать. Цель встать деньги адвокат.                                               |       72 | 2006-03-04 00:00:00
 129 |       1 | г. Москва, с. Териберка, бул. Баумана, д. 9/1, 591956                  |     12 |           7 |           1 |            0 | 11152755 | Возможно смертельный порода степь. Отъезд покидать угроза славный палата. Скрытый бак бабочка порт уточнить.                                                                     |       49 | 2004-09-07 00:00:00
 130 |       1 | г. Москва, ст. Городовиковск, пр. Новгородский, д. 8/7 к. 98, 150131   |      5 |           4 |           0 |            0 | 11271622 | Вскакивать помолчать полюбить отметить. Налево одиннадцать парень роса покинуть построить. Палец провал сравнение роса коммунизм бровь изба дрогнуть.                            |       87 | 2014-06-05 00:00:00
 131 |       1 | г. Москва, д. Дербент, бул. Павлика Морозова, д. 150 стр. 7/1, 431721  |     15 |           9 |           0 |            0 | 16411461 | Анализ умолять заложить задрать дружно. Порт хозяйка приятель построить. Вытаскивать дыхание место устройство порядок бак.                                                       |      129 | 2020-03-16 00:00:00
 132 |       1 | г. Москва, п. Жуковский, наб. Большевистская, д. 3/5 стр. 892, 756871  |     25 |           3 |           1 |            0 | 13276739 | Настать правление более конференция мягкий военный. Увеличиваться приличный угол трясти угроза.                                                                                  |       62 | 2014-05-13 00:00:00
 133 |       1 | г. Москва, клх Тымовское, алл. Тукая, д. 29 к. 3/2, 703594             |     12 |           4 |           1 |            0 | 19969529 | Бегать магазин порт. Сбросить сомнительный отметить наступать. Медицина строительство мягкий задержать похороны.                                                                 |       90 | 2019-03-14 00:00:00
 134 |       1 | г. Москва, п. Усть-Илимск, алл. 40 лет Октября, д. 25, 896111          |     10 |           6 |           0 |            0 | 15412213 | Запеть художественный сравнение отметить один. Магазин ответить лететь хозяйка. Некоторый господь желание отдел исполнять костер.                                                |       19 | 2005-07-31 00:00:00
 135 |       1 | г. Москва, ст. Калевала, ул. Достоевского, д. 5, 319575                |     11 |           9 |           1 |            0 | 14712640 | Столетие конференция подземный решетка успокоиться мальчишка. Функция цель важный страсть торговля пятеро.                                                                       |       84 | 2012-11-03 00:00:00
 136 |       1 | г. Москва, ст. Камышин, пр. Южный, д. 532, 269576                      |     17 |           8 |           1 |            0 | 19292169 | Наступать рот сохранять интеллектуальный. Вряд прежний ставить зима. Промолчать приличный художественный жестокий.                                                               |      145 | 2018-11-19 00:00:00
 137 |       1 | г. Москва, г. Усть-Катав, ул. Нахимова, д. 981 к. 71, 689674           |     10 |           1 |           0 |            0 | 18636076 | О палец какой лапа. Полоска прощение висеть. Устройство носок табак бригада пропаганда спешить неудобно. Бегать слишком достоинство неожиданный мера школьный научить танцевать. |       69 | 2008-01-04 00:00:00
 138 |       1 | г. Москва, п. Котельнич, ул. Медицинская, д. 81 стр. 852, 048195       |      7 |           4 |           1 |            0 | 19733546 | Достоинство зачем что решетка постоянный увеличиваться один цвет. Налево протягивать район предоставить секунда. Самостоятельно аж виднеться степь.                             +|      105 | 2022-10-14 00:00:00
     |         |                                                                        |        |             |             |              |          | Сынок хлеб основание песня второй болото.                                                                                                                                        |          |
 139 |       1 | г. Москва, к. Юрюзань, ул. Республиканская, д. 390 к. 257, 531636      |     16 |           9 |           1 |            0 | 11245747 | При приятель материя ленинград. Спасть направо промолчать гулять уронить близко руководитель. Протягивать намерение решение поймать костер монета слать.                         |       90 | 2020-03-06 00:00:00
 140 |       1 | г. Москва, п. Тотьма, бул. Мичурина, д. 207 стр. 7/5, 314394           |     23 |           4 |           1 |            0 | 16332250 | Человечек смелый сверкать. Палата изредка тута вытаскивать.                                                                                                                     +|       20 | 2004-08-08 00:00:00
     |         |                                                                        |        |             |             |              |          | Бочок провал освобождение нож единый другой.                                                                                                                                    +|          |
     |         |                                                                        |        |             |             |              |          | Казнь неудобно совещание наступать падаль потом оставить крутой. Трубка а полоска.                                                                                               |          |
 141 |       1 | г. Москва, к. Калачинск, ул. Титова, д. 6 стр. 2, 433438               |     20 |           9 |           0 |            0 | 19324317 | Прощение банк трясти неправда цвет. Витрина ныне кожа строительство выбирать более коробка. Даль изображать соответствие подземный изображать а.                                 |       80 | 2007-06-29 00:00:00
 142 |       1 | г. Москва, клх Владимир, бул. Свердлова, д. 88 к. 75, 550271           |      3 |           1 |           1 |            0 | 16674005 | Присесть плясать ответить дрогнуть второй. Магазин славный дьявол парень. Военный бригада роскошный.                                                                             |       31 | 2013-11-17 00:00:00
 143 |       1 | г. Москва, клх Шуя, бул. Юбилейный, д. 8 стр. 72, 808193               |      6 |           9 |           0 |            0 | 19932881 | Собеседник лапа эффект. Деловой бегать кузнец за даль нажать человечек песенка.                                                                                                  |      145 | 2020-10-02 00:00:00
(20 строк)

INSERT 0 20

delete FROM REALTY_OBJECT WHERE ID>23;

Запрос:

WITH x AS (SELECT to_char(r.DATE_OF_ANNOUNCEMENT, 'yyyy') yr FROM REALTY_OBJECT r),
	x1 as (SELECT x.yr, COUNT(*) cnt FROM x GROUP BY x.yr)
	SELECT * FROM x1 WHERE cnt BETWEEN 2 AND 3;

5:

Поправка:

UPDATE SALE SET REALTY_OBJECT_ID = 18 WHERE ID = 16;
UPDATE SALE SET REALTY_OBJECT_ID = 19 WHERE ID = 17;

INSERT INTO SALE VALUES
(144, 20, '2022-07-23', 12, 11999999),
(145, 21, '2023-01-23', 12, 16999999)
RETURNING *;

Поправка #2:

INSERT INTO REALTOR VALUES
	(507, 'Дорохов', 'Михаил', 'Александрович', '+7 (495) 727 77 77')
RETURNING ID;

INSERT INTO SALE VALUES
	(508, 20, '2022-07-23', 507, 11999999)
RETURNING *;

Запрос:

WITH x AS (SELECT to_char(s.DATE_OF_SALE, 'yyyy')::INT yr, (r.LAST_NAME || ' ' || r.FIRST_NAME || ' ' || r.PATRONYMIC) fio FROM SALE s, REALTOR r WHERE s.REALTOR_ID = r.ID),
	x1 as (SELECT x.fio, array_agg(x.yr) arrYr FROM x GROUP BY x.fio)
	SELECT * FROM x1 WHERE 2023 != ALL(x1.arrYr);

6:

Дополнительная генерация данных:

SELECT faker.faker('ru_RU');

INSERT INTO REALTOR
SELECT (i + 145), faker.last_name_female(), faker.first_name_female(),
	faker.middle_name_female(), faker.phone_number() from generate_series(1,7) i
RETURNING *;

 id  |    last_name    |   first_name    |   patronymic    |        phone
-----+-----------------+-----------------+-----------------+----------------------
 146 | Зуева           | Вера            | Сергеевна       | +75891409402
 147 | Муравьева       | Фёкла           | Тимофеевна      | +7 910 553 9831
 148 | Исаева          | Евфросиния      | Егоровна        | +7 (451) 437-71-57
 149 | Андреева        | Анжелика        | Львовна         | +7 (023) 452-15-34
 150 | Максимова       | Агата           | Федоровна       | +7 660 952 6066
 151 | Медведева       | Зоя             | Альбертовна     | 8 (266) 872-0803
 152 | Андреева        | Иванна          | Филипповна      | 8 498 424 87 46
(7 строк)

INSERT 0 7

INSERT INTO AREA SELECT
	(i + 152), faker.street_title() from generate_series(1,4) i
RETURNING *;

 id  |              name
-----+--------------------------------
 153 | Механическая
 154 | Волочаевская
 155 | Заозерная
 156 | Молодежная
(4 строки)

INSERT 0 4

WITH idA AS (SELECT id FROM AREA a)
INSERT INTO REALTY_OBJECT SELECT
	(i + 156), (SELECT * FROM idA WHERE i=i ORDER BY random() LIMIT 1),
	'г. Москва, ' || faker.address(), rand(1, 25), rand(1, 10),rand(), 0,
	rand(10000000, 20000000), faker.text(), rand(10, 150),
	faker.date_between('-50y')::timestamp from generate_series(1,30) i
RETURNING *;

 id  | area_id |                                address                                 | flooor | count_rooms | type_object | state_object |  price   |                                                                                        description                                                                                         | the_area | date_of_announcement
-----+---------+------------------------------------------------------------------------+--------+-------------+-------------+--------------+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------+----------------------
 157 |     156 | г. Москва, к. Чусовой, ул. Привокзальная, д. 7/6 к. 66, 472355         |      3 |           6 |           0 |            0 | 11953353 | Хозяйка горький научить. Выражение белье витрина. Разводить монета аж.                                                                                                                    +|       99 | 1992-08-19 00:00:00
     |         |                                                                        |        |             |             |              |          | Невозможно сынок покинуть четко правление кольцо возникновение. Смертельный второй соответствие уничтожение.                                                                               |          |
 158 |     156 | г. Москва, п. Зарайск, наб. Кирпичная, д. 8/1 стр. 1, 930483           |     15 |           4 |           1 |            0 | 12419463 | Костер болото изучить угроза рота новый. Похороны наткнуться мягкий задержать ученый развитый холодно. Очередной крыса пробовать выраженный.                                               |       74 | 1987-10-16 00:00:00
 159 |       0 | г. Москва, к. Гремячинск (Бурят.), бул. Мостовой, д. 1/6 к. 22, 219908 |     16 |           6 |           0 |            0 | 16502357 | Бригада висеть разнообразный нож покинуть. Возмутиться засунуть роскошный песня покидать забирать расстройство.                                                                            |       32 | 2006-04-04 00:00:00
 160 |     153 | г. Москва, д. Темрюк, алл. Тамбовская, д. 23 к. 60, 615283             |     11 |           6 |           0 |            0 | 12609191 | Желание неожиданный мотоцикл порог рабочий результат. Багровый обида о пламя перебивать. Белье мелькнуть вряд райком витрина изображать инвалид.                                           |      134 | 1994-12-25 00:00:00
 161 |       1 | г. Москва, г. Назрань, бул. Плеханова, д. 2/8, 152925                  |     13 |           9 |           0 |            0 | 13945353 | Кидать означать армейский банда правление металл бригада. Юный о интернет поколение грустный стакан радость.                                                                               |       75 | 1989-12-07 00:00:00
 162 |     155 | г. Москва, ст. Выборг, пер. Крылова, д. 6 стр. 5, 349902               |     23 |          10 |           1 |            0 | 18771190 | Передо подробность дорогой страсть. Тесно коричневый пол присесть самостоятельно. Уронить кожа появление полоска.                                                                          |      104 | 2018-11-22 00:00:00
 163 |       1 | г. Москва, к. Красногорск (Моск.), ш. Чапаева, д. 7 к. 6/6, 190439     |      8 |           8 |           1 |            0 | 19139814 | Социалистический поговорить совещание функция даль. Приходить покидать аллея.                                                                                                             +|      107 | 1995-12-12 00:00:00
     |         |                                                                        |        |             |             |              |          | Военный песенка спорт. Строительство тяжелый триста тюрьма радость вряд.                                                                                                                  +|          |
     |         |                                                                        |        |             |             |              |          | Хотеть собеседник мучительно.                                                                                                                                                              |          |
 164 |     156 | г. Москва, клх Омск, пр. Клары Цеткин, д. 78 к. 997, 352422            |     24 |           2 |           1 |            0 | 16022991 | Засунуть головка роскошный степь бровь потянуться вытаскивать. Боец покидать слать костер легко сутки манера. Палка нажать возмутиться единый.                                             |      130 | 2016-08-03 00:00:00
 165 |       2 | г. Москва, к. Ярославль, ш. Новостройка, д. 292 к. 7, 570136           |     18 |           9 |           1 |            0 | 16028006 | Тревога поздравлять помимо каюта подземный. Присесть мрачно адвокат покинуть командир художественный валюта.                                                                               |       82 | 2022-09-19 00:00:00
 166 |     154 | г. Москва, ст. Минусинск, пер. Бригадный, д. 124, 245518               |     11 |           2 |           0 |            0 | 11166789 | Столетие что сустав пробовать одиннадцать пробовать степь. Смелый похороны вздрагивать упор славный.                                                                                      +|      141 | 2010-06-17 00:00:00
     |         |                                                                        |        |             |             |              |          | Изучить казнь дошлый палата функция. Заработать появление правление горький провинция способ.                                                                                              |          |
 167 |       0 | г. Москва, с. Урус-Мартан, ул. Дорожная, д. 989 к. 440, 007195         |      9 |           6 |           0 |            0 | 15370860 | Монета лететь жить темнеть сомнительный. Сбросить функция редактор премьера жить горький провал.                                                                                           |       62 | 2008-02-22 00:00:00
 168 |     153 | г. Москва, к. Азов (Рост.), бул. Щорса, д. 466 к. 5, 337233            |      2 |          10 |           1 |            0 | 17164938 | Вперед вообще рай аллея космос. Хотеть радость пересечь передо. Народ написать процесс миг мгновение.                                                                                     +|      104 | 1976-05-09 00:00:00
     |         |                                                                        |        |             |             |              |          | Важный выдержать товар. Банда хотеть появление недостаток жестокий. Один помимо помимо понятный.                                                                                           |          |
 169 |       1 | г. Москва, клх Чермоз, наб. Трудовая, д. 4 к. 6/8, 165783              |      1 |           3 |           1 |            0 | 14123241 | За посвятить да торопливый. Через прежний радость. Бегать отметить актриса избегать.                                                                                                       |       53 | 1979-08-13 00:00:00
 170 |       1 | г. Москва, к. Стерлитамак, наб. Герцена, д. 8/9 стр. 6/2, 010215       |      8 |           3 |           0 |            0 | 14159370 | Редактор растеряться трясти. Палата песня бригада военный конференция сутки. Невыносимый оборот находить поколение дыхание.                                                                |       14 | 1980-09-13 00:00:00
 171 |       2 | г. Москва, клх Моршанск, пер. Челюскинцев, д. 2/3 к. 4/6, 486209       |     18 |           5 |           0 |            0 | 19433889 | Триста пища дрогнуть недостаток. Коллектив даль мучительно.                                                                                                                               +|      142 | 2020-09-06 00:00:00
     |         |                                                                        |        |             |             |              |          | Изредка перебивать головка тусклый механический. Заработать передо прежде ломать бабочка. Фонарик коричневый ремень.                                                                       |          |
 172 |       0 | г. Москва, ст. Лагань, наб. Чехова, д. 5/4, 436424                     |      6 |           3 |           0 |            0 | 11833959 | Приятель ведь ночь некоторый редактор. Угроза изображать какой полностью казнь народ пропадать.                                                                                           +|       36 | 2004-07-12 00:00:00
     |         |                                                                        |        |             |             |              |          | Функция умирать карман песенка передо. Дурацкий опасность смелый космос.                                                                                                                   |          |
 173 |     155 | г. Москва, к. Джубга, бул. Дорожный, д. 9/6 к. 715, 916036             |     22 |           5 |           0 |            0 | 17756995 | Что зеленый порода услать. Изображать актриса металл мелькнуть а.                                                                                                                         +|       36 | 1995-02-23 00:00:00
     |         |                                                                        |        |             |             |              |          | Падать художественный бетонный назначить слишком поставить эпоха. Славный жестокий материя похороны разводить назначить.                                                                   |          |
 174 |     153 | г. Москва, к. Егорьевск, пер. Серова, д. 8 стр. 29, 774217             |      2 |           6 |           0 |            0 | 12868041 | Достоинство господь скользить передо ставить. Наслаждение смертельный князь командование. Пробовать решетка бегать хотеть зачем виднеться поставить банда.                                 |      112 | 2008-10-13 00:00:00
 175 |       1 | г. Москва, клх Новый Уренгой, алл. Курчатова, д. 46, 155808            |     15 |           6 |           1 |            0 | 15720075 | Инвалид отдел серьезный передо миф кидать. Грустный совещание жестокий банда. Трубка четыре ботинок полностью.                                                                            +|      108 | 2020-08-03 00:00:00
     |         |                                                                        |        |             |             |              |          | Триста место ремень указанный. Мучительно расстегнуть доставать грустный приятель.                                                                                                         |          |
 176 |       0 | г. Москва, к. Шереметьево, пер. Победы, д. 7/5 к. 6, 358925            |      8 |           2 |           0 |            0 | 11028035 | Свежий металл вздрогнуть. Приходить снимать правление пробовать пламя житель.                                                                                                             +|       56 | 2017-05-24 00:00:00
     |         |                                                                        |        |             |             |              |          | Равнодушный ныне совет.                                                                                                                                                                   +|          |
     |         |                                                                        |        |             |             |              |          | Ответить банда набор товар передо ребятишки. Слишком теория полюбить необычный.                                                                                                            |          |
 177 |     156 | г. Москва, д. Йошкар-Ола, пер. Петровский, д. 4/7, 688839              |      8 |           8 |           0 |            0 | 11133092 | Четыре второй манера исследование видимо боец. Дрогнуть господь вчера боец избегать волк. Основание назначить хлеб сопровождаться вариант.                                                 |       71 | 2003-04-26 00:00:00
 178 |     156 | г. Москва, п. Галич, пер. Железнодорожный, д. 6, 547870                |      9 |           9 |           1 |            0 | 17106343 | Серьезный прежде важный серьезный багровый редактор наслаждение. Разнообразный господь протягивать. Тусклый штаб товар.                                                                    |       63 | 2018-04-26 00:00:00
 179 |     156 | г. Москва, г. Рязань, алл. Портовая, д. 14 к. 765, 549394              |     18 |           3 |           0 |            0 | 10494107 | Дальний торговля отметить серьезный медицина висеть термин холодно. Кидать правильный райком пробовать самостоятельно трубка тысяча заявление. Командование кожа пастух.                   |       66 | 1989-08-03 00:00:00
 180 |     155 | г. Москва, ст. Видное, наб. Болотная, д. 3 к. 98, 813677               |     22 |           8 |           1 |            0 | 10255083 | Трубка исполнять военный уничтожение промолчать. Коммунизм зато спорт прощение мелочь вообще. Темнеть белье прощение коробка а дьявол.                                                     |      113 | 1983-08-25 00:00:00
 181 |     153 | г. Москва, д. Хасавюрт, пер. Кузнечный, д. 10, 372735                  |     23 |           3 |           1 |            0 | 18002808 | Падать невыносимый головной близко. Костер поезд покинуть более карандаш некоторый. Житель постоянный советовать покидать находить.                                                       +|       54 | 2015-12-04 00:00:00
     |         |                                                                        |        |             |             |              |          | Темнеть потянуться а очко столетие. Запретить хотеть за носок.                                                                                                                             |          |
 182 |       0 | г. Москва, с. Пятигорск, бул. Подстанция, д. 638, 134684               |      7 |           7 |           0 |            0 | 10634781 | Тута намерение пища невыносимый. Ботинок зато заплакать сомнительный зато счастье секунда зима. Райком тысяча трубка интернет уничтожение трясти радость.                                  |       87 | 1994-07-03 00:00:00
 183 |     153 | г. Москва, г. Славянск-на-Кубани, ул. Серова, д. 579 к. 80, 260549     |      8 |           4 |           0 |            0 | 16125335 | Лапа юный спорт выраженный. Июнь терапия дыхание актриса появление блин правление. Поймать пространство триста заявление мгновение порода тревога голубчик.                                |       21 | 2015-03-09 00:00:00
 184 |     155 | г. Москва, д. Печенга, ш. Л.Толстого, д. 1/7 стр. 34, 480225           |     15 |           7 |           1 |            0 | 17857456 | Монета социалистический поезд назначить означать спасть. Очко аллея прежде засунуть коричневый мучительно. Освобождение лапа около актриса. Увеличиваться запретить находить развернуться. |       30 | 2020-12-26 00:00:00
 185 |     153 | г. Москва, д. Сунтар, алл. Юбилейная, д. 4/5 к. 9, 052205              |     15 |           9 |           0 |            0 | 11682152 | Медицина светило дошлый. Бабочка пробовать освобождение солнце. Нажать присесть мучительно подробность заявление.                                                                          |       33 | 1999-04-13 00:00:00
 186 |       2 | г. Москва, с. Пинега, алл. Крупской, д. 8/2 к. 432, 438099             |     23 |           4 |           0 |            0 | 10908950 | Пропаганда угол наткнуться подземный следовательно около.                                                                                                                                 +|       20 | 1996-09-25 00:00:00
     |         |                                                                        |        |             |             |              |          | Еврейский гулять роскошный зачем сходить. Аллея зеленый наступать художественный покидать мусор художественный.                                                                            |          |
(30 строк)

INSERT 0 30

delete FROM REALTY_OBJECT WHERE ID>156;

WITH idRO AS (SELECT id FROM REALTY_OBJECT r WHERE r.STATE_OBJECT = 0),
	idRR AS (SELECT id FROM REALTOR r)
INSERT INTO SALE SELECT
	(i + 186), (SELECT * FROM idRO WHERE i=i ORDER BY random() LIMIT 1),
	faker.date_between('-10y')::timestamp,
	(SELECT * FROM idRR WHERE i=i ORDER BY random() LIMIT 1), rand(10000000, 20000000)
	from generate_series(1,100) i
RETURNING *;

 id  | realty_object_id |    date_of_sale     | realtor_id |  price
-----+------------------+---------------------+------------+----------
 187 |              126 | 2017-02-10 00:00:00 |        149 | 11710470
 188 |               20 | 2022-04-07 00:00:00 |        152 | 11242763
 189 |              137 | 2015-07-13 00:00:00 |        148 | 11544268
 190 |               22 | 2015-11-14 00:00:00 |        148 | 17801030
 191 |              161 | 2014-05-11 00:00:00 |        151 | 18842572
 192 |              157 | 2015-10-15 00:00:00 |         12 | 19702768
 193 |              172 | 2018-04-14 00:00:00 |        147 | 19406859
 194 |              165 | 2019-10-25 00:00:00 |        151 | 18000843
 195 |              173 | 2022-10-29 00:00:00 |         12 | 13566120
 196 |              136 | 2015-11-11 00:00:00 |         13 | 13327024
 197 |              125 | 2015-04-11 00:00:00 |        148 | 15275118
 198 |              167 | 2017-02-09 00:00:00 |         13 | 15310754
 199 |              172 | 2016-04-14 00:00:00 |        152 | 10465006
 200 |              143 | 2017-07-13 00:00:00 |         13 | 12320778
 201 |              175 | 2014-04-14 00:00:00 |         13 | 19503294
 202 |              128 | 2017-01-24 00:00:00 |        149 | 19881827
 203 |               23 | 2023-07-12 00:00:00 |        147 | 13796153
 204 |              161 | 2017-09-27 00:00:00 |        148 | 14677234
 205 |              139 | 2020-07-04 00:00:00 |         12 | 15487586
 206 |              159 | 2017-01-06 00:00:00 |        149 | 10784119
 207 |              143 | 2020-08-24 00:00:00 |        149 | 12100596
 208 |              175 | 2014-04-24 00:00:00 |        146 | 12117347
 209 |               21 | 2014-10-11 00:00:00 |        150 | 12993099
 210 |              143 | 2016-12-29 00:00:00 |        152 | 10976757
 211 |              142 | 2015-11-25 00:00:00 |        149 | 12462558
 212 |              142 | 2022-02-09 00:00:00 |        146 | 12283415
 213 |              166 | 2019-03-30 00:00:00 |        146 | 18490149
 214 |              160 | 2017-02-21 00:00:00 |        147 | 15074156
 215 |              136 | 2015-11-27 00:00:00 |        150 | 13195347
 216 |              162 | 2018-09-16 00:00:00 |        152 | 16841214
 217 |              166 | 2023-10-26 00:00:00 |        152 | 12565275
 218 |              135 | 2019-02-03 00:00:00 |         14 | 12257240
 219 |              135 | 2023-01-31 00:00:00 |         14 | 19141185
 220 |              171 | 2023-10-05 00:00:00 |        151 | 12720135
 221 |              137 | 2022-08-17 00:00:00 |        146 | 16699321
 222 |              165 | 2023-04-14 00:00:00 |        148 | 18882351
 223 |              142 | 2019-01-28 00:00:00 |         14 | 10053372
 224 |              161 | 2018-03-29 00:00:00 |         14 | 19656539
 225 |              143 | 2020-08-13 00:00:00 |         14 | 12667452
 226 |              169 | 2022-07-27 00:00:00 |        152 | 15526502
 227 |              175 | 2016-10-19 00:00:00 |        146 | 12471792
 228 |               18 | 2017-09-16 00:00:00 |        152 | 15004305
 229 |              142 | 2019-01-11 00:00:00 |        152 | 13820565
 230 |              165 | 2023-11-11 00:00:00 |        149 | 11298981
 231 |                3 | 2018-04-20 00:00:00 |         14 | 12761657
 232 |              166 | 2016-08-20 00:00:00 |        146 | 14460049
 233 |              125 | 2017-01-29 00:00:00 |        149 | 18029305
 234 |              124 | 2020-01-06 00:00:00 |        150 | 16881865
 235 |              139 | 2023-05-28 00:00:00 |        152 | 19589933
 236 |               23 | 2020-11-07 00:00:00 |        147 | 19785319
 237 |              136 | 2017-09-05 00:00:00 |        150 | 15931580
 238 |              171 | 2017-04-10 00:00:00 |        148 | 12876882
 239 |              177 | 2016-03-04 00:00:00 |         13 | 17365725
 240 |              134 | 2020-07-08 00:00:00 |         13 | 13099078
 241 |                3 | 2020-09-12 00:00:00 |        149 | 17814875
 242 |              180 | 2015-08-22 00:00:00 |        147 | 14618049
 243 |              160 | 2015-10-18 00:00:00 |         14 | 13939064
 244 |              182 | 2014-03-23 00:00:00 |        147 | 16574558
 245 |              130 | 2015-11-30 00:00:00 |        146 | 15579171
 246 |              164 | 2020-11-14 00:00:00 |        150 | 14440492
 247 |              185 | 2022-09-11 00:00:00 |        150 | 14148659
 248 |              159 | 2019-06-23 00:00:00 |        152 | 13075331
 249 |              179 | 2016-05-26 00:00:00 |        150 | 12028624
 250 |              136 | 2018-11-05 00:00:00 |        146 | 19648093
 251 |              129 | 2020-05-13 00:00:00 |        148 | 12493913
 252 |              139 | 2016-10-22 00:00:00 |        150 | 19244403
 253 |              124 | 2019-08-12 00:00:00 |        148 | 10874584
 254 |              139 | 2022-12-02 00:00:00 |        147 | 14536954
 255 |              160 | 2017-10-24 00:00:00 |        152 | 18555029
 256 |               22 | 2017-09-05 00:00:00 |         13 | 18396789
 257 |              128 | 2016-01-10 00:00:00 |         14 | 15433759
 258 |              182 | 2016-11-18 00:00:00 |         14 | 19315936
 259 |              127 | 2022-01-14 00:00:00 |        151 | 11188746
 260 |                3 | 2017-05-05 00:00:00 |        150 | 15996416
 261 |              179 | 2017-11-30 00:00:00 |        148 | 15086935
 262 |              136 | 2023-05-02 00:00:00 |         12 | 16577211
 263 |              173 | 2016-02-27 00:00:00 |         12 | 16287694
 264 |              128 | 2020-03-22 00:00:00 |        148 | 13962974
 265 |               18 | 2023-11-17 00:00:00 |         13 | 12802155
 266 |              179 | 2014-10-15 00:00:00 |        148 | 12679208
 267 |               19 | 2018-03-31 00:00:00 |        148 | 17861317
 268 |              171 | 2022-02-28 00:00:00 |        152 | 12691320
 269 |                3 | 2021-11-07 00:00:00 |        147 | 13626326
 270 |              176 | 2018-05-05 00:00:00 |        150 | 18135828
 271 |              136 | 2018-03-19 00:00:00 |        148 | 12535268
 272 |              184 | 2020-07-22 00:00:00 |        148 | 14651795
 273 |              140 | 2018-04-15 00:00:00 |        148 | 15952862
 274 |              126 | 2020-06-23 00:00:00 |        151 | 15571144
 275 |              143 | 2020-10-26 00:00:00 |        152 | 14796336
 276 |              126 | 2021-08-21 00:00:00 |        149 | 19323176
 277 |              130 | 2014-02-15 00:00:00 |        150 | 13257182
 278 |              133 | 2022-06-22 00:00:00 |        150 | 11009523
 279 |              176 | 2020-05-17 00:00:00 |        146 | 14149901
 280 |                3 | 2014-09-23 00:00:00 |        148 | 16376272
 281 |              181 | 2016-05-07 00:00:00 |         13 | 19776810
 282 |              177 | 2015-03-11 00:00:00 |        149 | 14760417
 283 |              163 | 2018-06-11 00:00:00 |         14 | 14445818
 284 |              183 | 2021-04-17 00:00:00 |        152 | 14335922
 285 |              129 | 2014-09-19 00:00:00 |         14 | 19009324
 286 |              141 | 2020-04-05 00:00:00 |         13 | 13465027
(100 строк)

INSERT 0 100

delete FROM SALE WHERE ID>186;

Запрос:

WITH x AS (SELECT DISTINCT (rR.LAST_NAME || ' ' || LEFT(rR.FIRST_NAME, 1) || '. ' || LEFT(rR.PATRONYMIC, 1) || '.') fio, rO.AREA_ID idROA FROM SALE s, REALTOR rR, REALTY_OBJECT rO WHERE s.REALTOR_ID = rR.ID AND s.REALTY_OBJECT_ID = rO.ID),
	x1 as (SELECT x.fio, COUNT(x.idROA) cnt, array_agg(x.idROA) arrIdROA FROM x GROUP BY x.fio)
	SELECT * FROM x1 WHERE cnt > 2;

7:

SELECT a.NAME, rnd(AVG(r.THE_AREA), 2) FROM REALTY_OBJECT r, AREA a WHERE r.AREA_ID = a.ID AND r.STATE_OBJECT = 1 GROUP BY a.NAME;

8:

WITH x AS (SELECT (rR.LAST_NAME || ' ' || rR.FIRST_NAME || ' ' || rR.PATRONYMIC) fio, to_char(s.DATE_OF_SALE, 'yyyy')::INT d, s.id idS FROM SALE s, REALTOR rR WHERE s.REALTOR_ID = rR.ID),
	x1 as (SELECT x.fio, x.d, COUNT(x.d) cnt, array_agg(x.idS) arrIdS FROM x GROUP BY x.fio, x.d)
	SELECT * FROM x1 WHERE cnt > 2;

9:

Дополнительная генерация данных:

WITH idRO AS (SELECT id FROM REALTY_OBJECT r WHERE r.STATE_OBJECT = 0),
	idRR AS (SELECT id FROM REALTOR r)
INSERT INTO SALE SELECT
	(i + 286), (SELECT * FROM idRO WHERE i=i ORDER BY random() LIMIT 1),
	faker.date_between('-1y')::timestamp,
	(SELECT * FROM idRR WHERE i=i ORDER BY random() LIMIT 1), rand(10000000, 20000000)
	from generate_series(1,100) i
RETURNING *;

 id  | realty_object_id |    date_of_sale     | realtor_id |  price
-----+------------------+---------------------+------------+----------
 287 |              161 | 2023-08-26 00:00:00 |        147 | 19567539
 288 |              168 | 2023-04-11 00:00:00 |        150 | 11447631
 289 |                3 | 2023-04-04 00:00:00 |         14 | 11914388
 290 |              131 | 2023-04-26 00:00:00 |        149 | 19260222
 291 |              162 | 2023-04-07 00:00:00 |         14 | 17256982
 292 |              167 | 2023-07-30 00:00:00 |        150 | 15646245
 293 |              143 | 2023-09-18 00:00:00 |        150 | 11614363
 294 |              159 | 2023-04-02 00:00:00 |         12 | 12535427
 295 |              172 | 2023-06-09 00:00:00 |         12 | 16323555
 296 |              132 | 2023-06-16 00:00:00 |         13 | 17808466
 297 |              178 | 2023-10-03 00:00:00 |        151 | 14785815
 298 |              131 | 2023-03-13 00:00:00 |        148 | 16793197
 299 |              177 | 2022-11-20 00:00:00 |        148 | 18036846
 300 |              124 | 2023-05-30 00:00:00 |        149 | 16099891
 301 |              164 | 2023-05-10 00:00:00 |         13 | 17904390
 302 |              178 | 2023-06-04 00:00:00 |         13 | 11354712
 303 |              166 | 2023-07-27 00:00:00 |         14 | 18823558
 304 |              136 | 2023-03-08 00:00:00 |        147 | 15516582
 305 |               21 | 2023-10-08 00:00:00 |        146 | 16680200
 306 |              133 | 2023-02-11 00:00:00 |        150 | 12121326
 307 |              166 | 2023-02-02 00:00:00 |        150 | 16024699
 308 |               20 | 2023-11-16 00:00:00 |         13 | 12116105
 309 |              142 | 2023-08-31 00:00:00 |        152 | 15101891
 310 |              166 | 2022-12-30 00:00:00 |        151 | 16202813
 311 |              171 | 2023-07-21 00:00:00 |        150 | 17309643
 312 |              168 | 2023-06-08 00:00:00 |         14 | 18754703
 313 |              178 | 2023-09-18 00:00:00 |        146 | 16450638
 314 |              186 | 2023-05-11 00:00:00 |         12 | 10818773
 315 |              170 | 2023-07-19 00:00:00 |        150 | 10935036
 316 |              142 | 2023-10-15 00:00:00 |        148 | 11153424
 317 |              177 | 2022-12-12 00:00:00 |        148 | 13324163
 318 |              134 | 2023-02-05 00:00:00 |        147 | 16224273
 319 |              178 | 2023-05-11 00:00:00 |        149 | 19240108
 320 |              166 | 2023-09-06 00:00:00 |        150 | 15868700
 321 |              138 | 2023-03-19 00:00:00 |         13 | 15387670
 322 |              184 | 2023-10-30 00:00:00 |        149 | 18830495
 323 |              173 | 2023-03-18 00:00:00 |        149 | 17923329
 324 |              169 | 2022-11-28 00:00:00 |        149 | 10854791
 325 |              157 | 2023-11-10 00:00:00 |         13 | 16799070
 326 |              167 | 2023-03-26 00:00:00 |         13 | 10777512
 327 |              157 | 2022-11-24 00:00:00 |        150 | 18253230
 328 |              132 | 2023-08-14 00:00:00 |         12 | 18650190
 329 |              180 | 2023-08-20 00:00:00 |        146 | 14993042
 330 |              182 | 2023-09-27 00:00:00 |        149 | 15183516
 331 |              164 | 2023-01-22 00:00:00 |        147 | 14811366
 332 |              135 | 2023-07-16 00:00:00 |        147 | 10556839
 333 |              163 | 2023-11-20 00:00:00 |         14 | 16549834
 334 |              133 | 2023-07-11 00:00:00 |        150 | 12404902
 335 |              172 | 2023-05-10 00:00:00 |         14 | 11828045
 336 |              183 | 2023-09-12 00:00:00 |        149 | 16852482
 337 |               20 | 2022-12-06 00:00:00 |         12 | 14020863
 338 |              179 | 2022-12-27 00:00:00 |        151 | 19288790
 339 |              165 | 2023-11-04 00:00:00 |        151 | 13346819
 340 |              130 | 2023-11-12 00:00:00 |         12 | 16310833
 341 |              124 | 2023-04-30 00:00:00 |        147 | 14112619
 342 |              168 | 2023-11-03 00:00:00 |        152 | 10523452
 343 |              160 | 2023-05-08 00:00:00 |        148 | 11136420
 344 |              168 | 2023-11-17 00:00:00 |         14 | 11064005
 345 |              172 | 2023-04-16 00:00:00 |        151 | 16853115
 346 |              130 | 2022-11-29 00:00:00 |         12 | 17436621
 347 |              186 | 2023-09-26 00:00:00 |        148 | 10442761
 348 |              143 | 2022-12-26 00:00:00 |         14 | 14531156
 349 |              126 | 2023-09-17 00:00:00 |        146 | 16697981
 350 |              174 | 2023-09-10 00:00:00 |        148 | 13203057
 351 |              127 | 2023-09-01 00:00:00 |         14 | 14690650
 352 |              125 | 2022-12-06 00:00:00 |        148 | 12293508
 353 |              160 | 2023-10-05 00:00:00 |        147 | 17160469
 354 |              127 | 2023-06-20 00:00:00 |        148 | 13899598
 355 |              135 | 2023-04-28 00:00:00 |         14 | 16800103
 356 |              129 | 2022-11-22 00:00:00 |        147 | 14126666
 357 |              126 | 2023-10-22 00:00:00 |        152 | 10521366
 358 |               21 | 2023-02-20 00:00:00 |        146 | 19943173
 359 |              126 | 2023-01-11 00:00:00 |        151 | 13271681
 360 |              131 | 2023-06-27 00:00:00 |        148 | 19593139
 361 |              175 | 2023-04-09 00:00:00 |         12 | 19520322
 362 |              139 | 2023-06-24 00:00:00 |         13 | 12027798
 363 |              172 | 2022-11-27 00:00:00 |         12 | 13741872
 364 |              159 | 2023-10-20 00:00:00 |        146 | 19074478
 365 |              179 | 2022-11-28 00:00:00 |        152 | 17230505
 366 |              142 | 2023-01-03 00:00:00 |        149 | 12717340
 367 |              138 | 2023-07-12 00:00:00 |         13 | 18039004
 368 |              163 | 2023-08-10 00:00:00 |        150 | 12114329
 369 |              183 | 2023-02-13 00:00:00 |        146 | 11061317
 370 |               21 | 2023-03-25 00:00:00 |        149 | 14693003
 371 |              129 | 2022-12-28 00:00:00 |         14 | 18273727
 372 |              180 | 2023-08-04 00:00:00 |        149 | 11337655
 373 |              162 | 2023-11-12 00:00:00 |        146 | 13328092
 374 |              169 | 2023-10-20 00:00:00 |        147 | 16731998
 375 |              175 | 2023-08-18 00:00:00 |         14 | 17912758
 376 |              180 | 2023-11-13 00:00:00 |        148 | 17790258
 377 |              166 | 2023-06-04 00:00:00 |        152 | 12440618
 378 |              129 | 2023-11-12 00:00:00 |         14 | 19883621
 379 |              181 | 2022-12-08 00:00:00 |         14 | 18653952
 380 |              184 | 2023-01-09 00:00:00 |        148 | 11545938
 381 |               19 | 2023-05-11 00:00:00 |         13 | 11209139
 382 |              169 | 2023-09-08 00:00:00 |        150 | 19800419
 383 |              169 | 2023-08-11 00:00:00 |        147 | 12791200
 384 |              171 | 2023-08-02 00:00:00 |        149 | 16751442
 385 |              125 | 2023-04-10 00:00:00 |         14 | 14438527
 386 |              173 | 2023-09-30 00:00:00 |         13 | 15942110
(100 строк)

INSERT 0 100

Запрос:

WITH x AS (SELECT (LAST_NAME || ' ' || FIRST_NAME || ' ' || PATRONYMIC) fio, to_char(DATE_OF_SALE, 'mm')::INT d, s.id idS, PRICE FROM SALE s, REALTOR rR WHERE s.REALTOR_ID = rR.ID),
	x1 as (SELECT fio, d, COUNT(d) cnt, RND(SUM(PRICE) * 0.001, 1) sumR, array_agg(idS) arrIdS FROM x GROUP BY fio, d)
	SELECT * FROM x1 WHERE x1.d = 11 AND SUMR > 40000;

10:

Поправка:

UPDATE REALTY_OBJECT SET COUNT_ROOMS = rand(1, 5) WHERE TRUE;

Запрос:

--SELECT ARRAY[1, 2, 3, 4];

WITH x as (SELECT ARRAY['Однокомнатных квартир', 'Двухкомнатных квартир', 'Больше двух комнат'] des),
	x1 as (SELECT NAME, ARRAY[COUNT(COUNT_ROOMS = 1 OR NULL), COUNT(COUNT_ROOMS = 2 OR NULL), COUNT(COUNT_ROOMS > 2 OR NULL)] cnt, array_agg(r.id) filter(where COUNT_ROOMS = 1) arr1 FROM REALTY_OBJECT r, AREA a WHERE AREA_ID = a.ID AND NAME = 'Таганский' GROUP BY NAME)
	SELECT unnest(des) "Вид квартиры", unnest(cnt) "Количество объектов недвижимости" FROM x, x1;

--SELECT a.NAME, r.id, r.ADDRESS FROM REALTY_OBJECT r, AREA a WHERE r.AREA_ID = a.ID AND r.COUNT_ROOMS BETWEEN 1 AND 2;

--SELECT * FROM (VALUES ('Однокомнатных квартир'), ('Двухкомнатных квартир'), ('Больше двух комнат')) x;

11:

WITH x as (SELECT NAME, RND(AVG(VALUE), 1) avg FROM Score s, REALTY_OBJECT r, ASSESSMENT_CRITERION asCr WHERE REALTY_OBJECT_ID = 20 AND REALTY_OBJECT_ID = r.ID AND ASSESSMENT_CRITERION_ID = asCr.ID GROUP BY NAME)
	SELECT NAME "Критерий", (avg || ' из 5') "Средняя оценка", getText11(avg/5) "Текст" FROM x;

12:

Новая таблица:

CREATE TABLE STRUCTURE_REALTY_OBJECT (
	ID BIGINT PRIMARY KEY,
	REALTY_OBJECT_ID BIGINT REFERENCES REALTY_OBJECT (ID),
	TYPE BIGINT CHECK (TYPE BETWEEN 1 AND 4),
	THE_AREA BIGINT CHECK (THE_AREA > 0)
);

INSERT INTO STRUCTURE_REALTY_OBJECT VALUES
	(387, 3, 1, 50),
	(388, 4, 2, 50),
	(389, 5, 3, 50)
RETURNING *;

13:

Дополнительная генерация данных:

WITH idR AS (SELECT id FROM REALTY_OBJECT r)
INSERT INTO STRUCTURE_REALTY_OBJECT SELECT
	(i + 386), (SELECT * FROM idR WHERE i=i ORDER BY random() LIMIT 1),
	rand(1, 4), rand(1, 50)
	from generate_series(1,100) i
RETURNING *;

 id  | realty_object_id | type | the_area
-----+------------------+------+----------
 387 |              185 |    3 |       45
 388 |              184 |    2 |        1
 389 |              185 |    1 |       38
 390 |               18 |    2 |       19
 391 |              174 |    1 |       16
 392 |                3 |    2 |       32
 393 |              134 |    2 |       12
 394 |               23 |    2 |       40
 395 |              169 |    3 |       16
 396 |              134 |    2 |       29
 397 |              127 |    4 |       46
 398 |              184 |    4 |       46
 399 |               22 |    2 |       19
 400 |              131 |    4 |       27
 401 |              142 |    2 |       42
 402 |              139 |    3 |       32
 403 |              165 |    2 |       36
 404 |                3 |    2 |       38
 405 |              128 |    4 |       46
 406 |              134 |    2 |       46
 407 |              162 |    2 |       28
 408 |              166 |    3 |        9
 409 |              172 |    3 |       12
 410 |              130 |    1 |        7
 411 |              162 |    3 |       31
 412 |              158 |    2 |       43
 413 |              164 |    2 |       31
 414 |              182 |    4 |       46
 415 |               18 |    4 |       40
 416 |              159 |    2 |        7
 417 |              138 |    2 |       23
 418 |              175 |    2 |       38
 419 |              171 |    3 |        5
 420 |              126 |    3 |        4
 421 |              179 |    3 |       15
 422 |              134 |    2 |       19
 423 |              136 |    2 |       46
 424 |                5 |    4 |       27
 425 |              140 |    3 |       45
 426 |              170 |    1 |       19
 427 |                5 |    4 |       28
 428 |              184 |    3 |       39
 429 |               18 |    4 |       11
 430 |              132 |    4 |       27
 431 |              134 |    1 |       11
 432 |              184 |    2 |       26
 433 |              183 |    3 |       34
 434 |              168 |    3 |       35
 435 |              180 |    4 |       22
 436 |              171 |    1 |       22
 437 |              169 |    3 |       41
 438 |              168 |    4 |       40
 439 |              127 |    3 |       39
 440 |              125 |    3 |       12
 441 |              164 |    2 |       45
 442 |              130 |    2 |       48
 443 |              139 |    2 |       45
 444 |              180 |    4 |       30
 445 |              129 |    3 |       15
 446 |              141 |    3 |       15
 447 |                5 |    3 |       27
 448 |              161 |    1 |       41
 449 |              185 |    1 |       39
 450 |              184 |    2 |        4
 451 |              139 |    4 |       22
 452 |              181 |    3 |       24
 453 |               22 |    3 |       14
 454 |              125 |    2 |       49
 455 |              181 |    2 |       14
 456 |               23 |    3 |       49
 457 |                4 |    2 |       48
 458 |              174 |    2 |        7
 459 |              165 |    4 |       46
 460 |              172 |    3 |        3
 461 |              163 |    3 |       14
 462 |              164 |    2 |       32
 463 |              143 |    3 |       46
 464 |              126 |    3 |       24
 465 |              143 |    3 |       27
 466 |              131 |    3 |       32
 467 |              138 |    3 |       33
 468 |              137 |    1 |       46
 469 |                4 |    4 |       30
 470 |               22 |    2 |       15
 471 |              128 |    3 |       36
 472 |               18 |    2 |       41
 473 |              133 |    4 |       35
 474 |              171 |    2 |       13
 475 |              162 |    3 |       20
 476 |              133 |    2 |       37
 477 |              179 |    2 |       40
 478 |              136 |    1 |        6
 479 |              139 |    1 |       49
 480 |              131 |    3 |       35
 481 |              157 |    3 |       10
 482 |              186 |    3 |       14
 483 |              135 |    2 |       40
 484 |                5 |    1 |       35
 485 |              183 |    4 |       18
 486 |              142 |    3 |       17
(100 строк)

INSERT 0 100

delete FROM STRUCTURE_REALTY_OBJECT WHERE ID>386;

Запрос:

--SELECT REALTY_OBJECT_ID, array_agg(TYPE) FROM STRUCTURE_REALTY_OBJECT s GROUP BY REALTY_OBJECT_ID;

SELECT getTypeText(TYPE) "Тип комнаты", THE_AREA "Площадь" FROM STRUCTURE_REALTY_OBJECT s WHERE REALTY_OBJECT_ID = 184;

14:

WITH x as (SELECT getTypeText(TYPE) typ, THE_AREA FROM STRUCTURE_REALTY_OBJECT s WHERE REALTY_OBJECT_ID = 184),
	x1 as (SELECT SUM(THE_AREA) sum FROM x)
	SELECT typ "Тип комнаты", THE_AREA "Площадь", rnd(THE_AREA / sum, 2) * 100 "Процент площади" FROM x, x1;

15:

WITH x as (SELECT NAME, REALTY_OBJECT_ID, SUM(s.THE_AREA) sum FROM STRUCTURE_REALTY_OBJECT s, REALTY_OBJECT r, AREA a WHERE REALTY_OBJECT_ID = r.ID AND AREA_ID = a.ID GROUP BY NAME, REALTY_OBJECT_ID)
	SELECT NAME "Название района", COUNT(REALTY_OBJECT_ID) "Кол-во объектов", array_agg(REALTY_OBJECT_ID) "Объекты" FROM x WHERE sum > 40 GROUP BY NAME;

16:

SELECT r.ID "Квартира", DATE_OF_ANNOUNCEMENT "Дата объявления", DATE_OF_SALE "Дата продажи" FROM SALE s, REALTY_OBJECT r WHERE REALTY_OBJECT_ID = r.ID AND getDiffSec(DATE_OF_SALE, DATE_OF_ANNOUNCEMENT) BETWEEN 1 AND 10368000 GROUP BY r.ID, DATE_OF_ANNOUNCEMENT, DATE_OF_SALE;

17:

Дополнительная генерация данных:

WITH idA AS (SELECT id FROM AREA a)
INSERT INTO REALTY_OBJECT SELECT
	(i + 486), (SELECT * FROM idA WHERE i=i ORDER BY random() LIMIT 1),
	'г. Москва, ' || faker.address(), rand(1, 25), rand(1, 10), rand(), rand(),
	rand(10000000, 20000000), faker.text(), rand(10, 150),
	faker.date_between('-4M')::timestamp from generate_series(1,20) i
RETURNING *;

 id  | area_id |                                     address                                      | flooor | count_rooms | type_object | state_object |  price   |                                                                                              description                                                                                               | the_area | date_of_announcement
-----+---------+----------------------------------------------------------------------------------+--------+-------------+-------------+--------------+----------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------+----------------------
 487 |       2 | г. Москва, клх Усть-Кулом, пр. 50 лет ВЛКСМ, д. 2 к. 6/5, 750870                 |      7 |           7 |           1 |            1 | 13473382 | Товар жить висеть карман палец. Висеть еврейский термин тяжелый висеть серьезный освободить. Счастье запустить крутой сравнение результат около.                                                       |       87 | 2023-09-29 00:00:00
 488 |       2 | г. Москва, клх Токма, ул. Глинки, д. 8/8, 215380                                 |     13 |           6 |           1 |            0 | 13754653 | Очко поговорить ленинград песенка увеличиваться бак. Вывести сбросить жидкий плод бок наслаждение. Штаб аллея торговля триста спешить темнеть.                                                         |       67 | 2023-08-31 00:00:00
 489 |       1 | г. Москва, г. Обоянь, пр. Парковый, д. 7 к. 388, 867171                          |     20 |           2 |           1 |            0 | 18503542 | Расстегнуть привлекать сомнительный солнце миф еврейский. Поговорить нервно ведь ход багровый оставить.                                                                                               +|       67 | 2023-10-22 00:00:00
     |         |                                                                                  |        |             |             |              |          | Каюта руководитель порода скользить.                                                                                                                                                                   |          |
 490 |       1 | г. Москва, д. Листвянка (Иркут.), ул. Южная, д. 2/2 стр. 3/7, 812793             |     17 |           8 |           1 |            1 | 15138022 | Научить уничтожение темнеть прошептать упорно задрать. Посидеть магазин функция голубчик металл угол находить.                                                                                         |      107 | 2023-08-05 00:00:00
 491 |       1 | г. Москва, ст. Новгород Великий, ш. Мая 1, д. 38 к. 976, 189522                  |     23 |           8 |           1 |            1 | 14285728 | Ленинград висеть сопровождаться казнь нажать смелый тусклый.                                                                                                                                          +|      114 | 2023-09-25 00:00:00
     |         |                                                                                  |        |             |             |              |          | Жестокий настать правление монета другой совещание другой магазин. Порт зарплата правый. Правильный тяжелый валюта счастье цвет.                                                                       |          |
 492 |       0 | г. Москва, п. Шатки, алл. Заливная, д. 5 стр. 7, 127171                          |      5 |           3 |           1 |            0 | 15215432 | Угол цепочка поймать единый пол да. Возможно увеличиваться крутой один ягода достоинство.                                                                                                             +|      121 | 2023-11-01 00:00:00
     |         |                                                                                  |        |             |             |              |          | Ныне дремать металл. Пища князь встать горький висеть князь.                                                                                                                                           |          |
 493 |     154 | г. Москва, ст. Чита, ул. Шахтерская, д. 7/3, 905145                              |      4 |           7 |           1 |            1 | 18884441 | Присесть неудобно боец протягивать покидать пропаганда инвалид тесно. Художественный заплакать тревога применяться.                                                                                    |      106 | 2023-07-24 00:00:00
 494 |     156 | г. Москва, к. Осташков, пер. Николаева, д. 7/1 стр. 3, 061129                    |     21 |           9 |           0 |            0 | 10267819 | Банда торговля сохранять издали правый. Функция выражение чувство ручей. Рай порт пропасть собеседник эффект багровый вариант.                                                                         |       78 | 2023-11-12 00:00:00
 495 |     155 | г. Москва, ст. Ербогачен, наб. Геологическая, д. 9 к. 121, 821300                |      3 |           4 |           0 |            0 | 10723422 | Решение советовать тусклый палка факультет назначить плод граница. Демократия услать видимо мелочь сопровождаться. Пропасть изучить табак материя.                                                     |       77 | 2023-11-13 00:00:00
 496 |     153 | г. Москва, к. Шенкурск, ул. Воровского, д. 343, 671852                           |     11 |           1 |           1 |            1 | 19499515 | Кольцо каюта написать уточнить каюта налево гулять. Покидать торопливый плод пастух банк. Пробовать столетие заложить уничтожение выражаться космос.                                                   |      144 | 2023-10-08 00:00:00
 497 |       0 | г. Москва, г. Оленек, бул. Вахитова, д. 659 стр. 2/7, 591959                     |      9 |           6 |           0 |            0 | 13275364 | Выразить вариант стакан сомнительный помимо намерение решение. Сомнительный низкий сынок материя набор другой ставить.                                                                                 |       99 | 2023-08-16 00:00:00
 498 |       1 | г. Москва, с. Соль-Илецк, ш. Матросова, д. 7/5 стр. 98, 163047                   |     22 |           3 |           0 |            1 | 16785695 | Господь головной художественный руководитель инфекция дальний посвятить неожиданный. Монета еврейский командование ботинок наслаждение анализ штаб степь.                                              |      129 | 2023-08-29 00:00:00
 499 |       2 | г. Москва, г. Александровск-Сахалинский, ул. Тюленина, д. 4 к. 35, 602848        |     18 |           4 |           0 |            1 | 12749515 | Снимать школьный о достоинство медицина. Интернет полностью космос кидать банк успокоиться.                                                                                                            |       76 | 2023-09-28 00:00:00
 500 |     156 | г. Москва, д. Троицк (Моск.), пр. Проточный, д. 759 стр. 6, 388331               |     10 |           8 |           0 |            1 | 18709395 | Выкинуть инвалид ленинград четко. Коричневый посвятить войти невозможно запретить низкий.                                                                                                              |      149 | 2023-09-21 00:00:00
 501 |     156 | г. Москва, с. Приморско-Ахтарск, бул. Дружба, д. 94 к. 57, 843106                |     20 |           6 |           0 |            0 | 16434159 | Мера отъезд угодный лететь второй достоинство. Левый наслаждение салон сбросить набор. Сопровождаться тесно прежде носок провинция хозяйка рот.                                                        |       69 | 2023-10-19 00:00:00
 502 |     156 | г. Москва, д. Бирск, пр. Рябиновый, д. 4 к. 7, 649142                            |     24 |           5 |           1 |            0 | 13023097 | Премьера функция слишком сынок нож уточнить заявление. Спорт слишком деньги неожиданный спасть покидать грудь равнодушный.                                                                             |      125 | 2023-11-18 00:00:00
 503 |       1 | г. Москва, к. Чегем, бул. Буденного, д. 4 стр. 3/9, 775654                       |     13 |           4 |           1 |            1 | 19384952 | Идея конструкция актриса снимать. Волк виднеться разнообразный армейский нервно носок. Плод нажать зима рабочий ведь бровь.                                                                            |       69 | 2023-08-03 00:00:00
 504 |     154 | г. Москва, г. Киров (Вятка), ул. 40 лет Победы, д. 33, 587725                    |     17 |           2 |           1 |            0 | 11986189 | Солнце приятель мгновение ручей возможно. Процесс полевой бегать забирать рис карман покинуть.                                                                                                         |      138 | 2023-11-07 00:00:00
 505 |     155 | г. Москва, клх Надым, ул. Ивановская, д. 443, 337254                             |     16 |           4 |           0 |            1 | 13238138 | Второй задержать военный витрина прелесть за.                                                                                                                                                         +|       98 | 2023-09-26 00:00:00
     |         |                                                                                  |        |             |             |              |          | Основание поезд провинция витрина. Новый поколение белье печатать отметить означать. Зачем тяжелый домашний господь число.                                                                             |          |
 506 |       0 | г. Москва, клх Курганинск, ул. Трудовая, д. 643 стр. 16, 131492                  |     11 |           1 |           0 |            1 | 13135890 | Болото носок плясать художественный. Плавно запретить роскошный пробовать через налево нервно. Рассуждение постоянный спасть доставать. Рота промолчать монета космос нервно неожиданно следовательно. |      141 | 2023-10-09 00:00:00
(20 строк)


INSERT 0 20

delete FROM REALTY_OBJECT WHERE ID>486;

Запрос:

--SELECT r.ID "Квартира", DATE_OF_ANNOUNCEMENT "Дата объявления" FROM REALTY_OBJECT r WHERE getDiffSec(now()::timestamp, DATE_OF_ANNOUNCEMENT) BETWEEN 1 AND 10368000 GROUP BY r.ID, DATE_OF_ANNOUNCEMENT;

WITH x as (SELECT a, r, RND(PRICE / THE_AREA, 2) m2 FROM REALTY_OBJECT r, AREA a WHERE r.AREA_ID = a.ID),
	x1 as (SELECT a, RND(AVG((r).PRICE / (r).THE_AREA), 2) avg FROM x GROUP BY a)
	SELECT avg "Средняя по району", (r).ID, (r).ADDRESS "Адрес", m2, getTypeTextSt((r).STATE_OBJECT) "Статус" FROM x NATURAL INNER JOIN x1 WHERE m2 < avg AND getDiffSec(now()::timestamp, (r).DATE_OF_ANNOUNCEMENT) BETWEEN 1 AND 10368000 GROUP BY avg, r, m2;

18:

--SELECT NAME FROM SALE s, REALTY_OBJECT r, AREA a WHERE to_char(DATE_OF_SALE, 'yyyy')::INT > 2021 AND REALTY_OBJECT_ID = r.ID AND AREA_ID = a.ID GROUP BY NAME;

WITH x as (SELECT NAME, to_char(DATE_OF_SALE, 'yyyy')::INT yr FROM SALE s, REALTY_OBJECT r, AREA a WHERE REALTY_OBJECT_ID = r.ID AND AREA_ID = a.ID GROUP BY NAME, DATE_OF_SALE),
	x1 as (SELECT NAME, COUNT(yr = 2022 OR NULL)::FLOAT cnt22, COUNT(yr = 2023 OR NULL) cnt23 FROM x GROUP BY NAME)
	SELECT NAME "Название района", cnt23 "2023", cnt22 "2022", rnd((cnt22-cnt23)/cnt23, 4) * 100 "Разница в %" FROM x1;

19:

Поправка:

UPDATE REALTY_OBJECT SET TYPE_OBJECT = rand(0, 2) WHERE TRUE;

Запрос:

WITH x as (SELECT TYPE_OBJECT, s.PRICE, to_char(DATE_OF_SALE, 'yyyy')::INT yr FROM SALE s, REALTY_OBJECT r WHERE REALTY_OBJECT_ID = r.ID GROUP BY TYPE_OBJECT, s.PRICE, DATE_OF_SALE),
	x1 as (SELECT * FROM x WHERE yr = 2023),
	x2 as (SELECT COUNT(*)::float FROM x1),
	x3 as (SELECT TYPE_OBJECT FROM x1 GROUP BY TYPE_OBJECT),
	x4 as (SELECT TYPE_OBJECT, COUNT(*) cnt FROM x1 GROUP BY TYPE_OBJECT),
	x5 as (SELECT TYPE_OBJECT, SUM(PRICE) sum FROM x WHERE yr = 2023 GROUP BY TYPE_OBJECT)
	SELECT getTypeTextRO(TYPE_OBJECT) "Тип объекта недвижимости", cnt "Количество продаж", (rnd(cnt/count * 100, 0) || '%') "% от общего колва все проданных ОН", x5.sum "Общая сумма" FROM x2, x4 NATURAL INNER JOIN x5;
